import{a6 as e,r as x,d as A,b as D,o as L,j as n,x as d,J as q,D as j,F as u,z as k,cY as V,q as B,cZ as M,y as G,al as J,c_ as H,n as C,a7 as K}from"./index-BBwNWda_.js";import{u as P,a as O}from"./xlsx-BiIUQI8q.js";import{c as I}from"./index-BYtINa54.js";import{P as F}from"./Pagination-Dr02RiN_.js";import"./Anchor-B_1sJziF.js";e.object({id:e.string().uuid(),code:e.string(),fullName:e.string(),gender:e.enum(["Male","Female"]),age:e.string().regex(/^\d+$/,"L'âge doit être une chaîne numérique"),phone:e.string().optional().or(e.string().regex(/^\+243/,"Le numéro doit commencer par +243 (RDC uniquement)").regex(/^\+243[0-9]{9}$/,"Le numéro de téléphone doit contenir exactement 9 chiffres après +243")),identityDocumentNumber:e.string(),propertyType:e.string(),territory:e.string(),village:e.string(),longitude:e.string().regex(/^-?\d+(\.\d+)?$/,"Format de longitude invalide"),latitude:e.string().regex(/^-?\d+(\.\d+)?$/,"Format de latitude invalide"),referenceKilometerPoint:e.string(),orientation:e.string(),isVulnerable:e.boolean(),vulnerabilityType:e.string().optional(),coordonnees:e.string().regex(/^-?\d+(\.\d+)?,-?\d+(\.\d+)?$/,"Format de coordonnées invalide"),surface:e.number(),cu:e.number(),plusValue:e.number(),annexeSurface:e.number(),activiteCommerciale:e.string().optional(),arbreAffectee:e.string().optional(),nombreJours:e.number(),equivalentDollars:e.number(),perteRevenuLocatif:e.number(),assistanceDemenagement:e.number(),assistance_personne_vulnerable:e.number(),accordLiberationLieu:e.boolean()});const U=e.object({excel:e.instanceof(File,{message:"Veuillez sélectionner un fichier."}).refine(i=>i.type==="application/vnd.ms-excel"||i.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",{message:"Le fichier doit être un fichier Excel valide (.xls ou .xlsx)."})}),Y=e.object({code:e.string(),fullName:e.string(),gender:e.enum(["Male","Female"]),age:e.string().regex(/^\d+$/,"L'âge doit être une chaîne numérique"),phone:e.string().optional().or(e.string().regex(/^\+243/,"Le numéro doit commencer par +243 (RDC uniquement)").regex(/^\+243[0-9]{9}$/,"Le numéro de téléphone doit contenir exactement 9 chiffres après +243")),identityDocumentNumber:e.string(),propertyType:e.string(),territory:e.string(),village:e.string(),longitude:e.string().regex(/^-?\d+(\.\d+)?$/,"Format de longitude invalide"),latitude:e.string().regex(/^-?\d+(\.\d+)?$/,"Format de latitude invalide"),referenceKilometerPoint:e.string(),orientation:e.string(),isVulnerable:e.boolean(),vulnerabilityType:e.string().optional(),coordonnees:e.string().regex(/^-?\d+(\.\d+)?,-?\d+(\.\d+)?$/,"Format de coordonnées invalide"),surface:e.number(),cu:e.number(),plusValue:e.number(),annexeSurface:e.number(),activiteCommerciale:e.string().optional(),arbreAffectee:e.string().optional(),nombreJours:e.number(),equivalentDollars:e.number(),perteRevenuLocatif:e.number(),assistanceDemenagement:e.number(),assistance_personne_vulnerable:e.number(),accordLiberationLieu:e.boolean()});e.object({id:e.string(),reason:e.string()});e.object({id:e.string(),data:Y});e.object({pageNo:e.number().optional(),pageSize:e.number().optional(),sortBy:e.string().optional(),filter:e.string().optional()});const Z=({id:i,code:o})=>{const[t,c]=x.useState(!1),g=A(),{deleteStatus:b}=D(m=>m.pap),{register:v,handleSubmit:y,setError:S,formState:{errors:l}}=L(),a=()=>c(!1),f=async m=>{try{await g(V({id:i,reason:m.reason})).unwrap(),a()}catch{S("reason",{message:"Une erreur est survenue lors de la suppression."})}};return n.jsxs(n.Fragment,{children:[n.jsx(d,{variant:"danger",size:"sm",onClick:()=>c(!0),children:n.jsx(q,{})}),n.jsxs(j,{show:t,onHide:a,centered:!0,children:[n.jsx(j.Header,{closeButton:!0,children:n.jsx(j.Title,{children:"Supprimer le PAP"})}),n.jsxs(u,{onSubmit:y(f),children:[n.jsxs(j.Body,{children:[n.jsxs("p",{children:["Confirmez-vous la suppression du PAP suivant ?",n.jsx("br",{}),n.jsxs("strong",{children:["CODE: ",o]})]}),n.jsxs(u.Group,{className:"mb-3",children:[n.jsx(u.Label,{children:"Raison de la suppression"}),n.jsxs(u.Select,{...v("reason",{required:"La raison est requise."}),children:[n.jsx("option",{value:"",children:"-- Choisir une raison --"}),n.jsx("option",{value:"Bad data",children:"Données erronées"}),n.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),l.reason&&n.jsx(u.Text,{className:"text-danger",children:l.reason.message})]})]}),n.jsxs(j.Footer,{children:[n.jsx(d,{variant:"outline-secondary",onClick:a,children:"Annuler"}),n.jsx(d,{variant:"danger",type:"submit",disabled:b==="loading",children:b==="loading"?n.jsxs(n.Fragment,{children:[n.jsx(k,{size:"sm",className:"me-2"}),"Suppression..."]}):"Supprimer"})]})]})]})]})};function Q(i,o){const t=x.useRef(null);return x.useCallback((...g)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{i(...g)},o)},[i,o])}function te(){const i=A(),o=B(),{papList:t,status:c,error:g}=D(r=>r.pap),{handleSubmit:b,setValue:v,formState:{errors:y},reset:S}=L({resolver:K(U)}),l=10,[a,f]=x.useState(0),[m,N]=x.useState(""),w=Q(r=>{N(r),f(0)},500),E=()=>{const r=t.map((h,R)=>({"#":a*l+R+1,"Code PAP":h.code,"Nom complet":h.fullName,Sexe:h.gender,Âge:h.age,Téléphone:h.phone,"Pièce d'identité":h.identityDocumentNumber})),s=P.json_to_sheet(r),p=P.book_new();P.book_append_sheet(p,s,"PAP"),O(p,"liste_pap.xlsx")};x.useEffect(()=>{i(M({filter:m,pageSize:l,pageNo:a}))},[i,m,a,l]);const $=async r=>{try{await i(H(r)).unwrap(),C.success("Fichier envoyé avec succès! Les données sont en cours de génération."),S()}catch{C.error("Erreur lors de l'envoi du fichier.")}},T=r=>{var p;const s=(p=r.target.files)==null?void 0:p[0];s&&v("excel",s,{shouldValidate:!0})},_=Math.ceil(t.length/l),z=r=>{f(r)};return n.jsxs("div",{className:"container",children:[n.jsxs("header",{className:"d-flex justify-content-between align-items-center mb-4",children:[n.jsx("h2",{className:"mb-0",children:"Gestion PAP"}),n.jsxs("div",{className:"d-flex gap-3 align-items-center",children:[n.jsxs(u,{onSubmit:b($),className:"d-flex gap-2",children:[n.jsx(u.Control,{type:"file",accept:".xls, .xlsx",onChange:T,className:`form-control ${y.excel?"is-invalid":""}`}),n.jsx(d,{type:"submit",variant:"primary",children:"Envoyer"})]}),n.jsx(d,{variant:"success",onClick:()=>o("new"),children:"Créer"}),n.jsx(d,{variant:"outline-success",onClick:E,children:"Exp Excel"})]})]}),n.jsx(u.Control,{type:"text",placeholder:"Rechercher...",className:"mb-3",onChange:r=>w(r.target.value)}),n.jsxs(G,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"mb-4",children:[n.jsx("thead",{className:"table-dark",children:n.jsxs("tr",{children:[n.jsx("th",{children:"#"}),n.jsx("th",{children:"Code PAP"}),n.jsx("th",{children:"Nom complet"}),n.jsx("th",{children:"Sexe"}),n.jsx("th",{children:"Âge"}),n.jsx("th",{children:"Téléphone"}),n.jsx("th",{children:"Pièce d'identité"}),n.jsx("th",{children:"Actions"})]})}),n.jsxs("tbody",{children:[c==="loading"&&n.jsx("tr",{children:n.jsx("td",{colSpan:8,className:"text-center",children:n.jsx(k,{animation:"border",size:"sm"})})}),c==="failed"&&n.jsx("tr",{children:n.jsx("td",{colSpan:8,className:"text-center text-danger",children:g})}),c==="succeeded"&&t.length>0&&t.map((r,s)=>n.jsxs("tr",{children:[n.jsx("td",{children:a*l+s+1}),n.jsx("td",{children:r.code}),n.jsx("td",{children:r.fullName}),n.jsx("td",{children:r.gender}),n.jsx("td",{children:r.age}),n.jsx("td",{children:r.phone}),n.jsx("td",{children:r.identityDocumentNumber}),n.jsx("td",{children:n.jsxs("div",{className:"d-flex gap-2",children:[n.jsx(d,{variant:"info",size:"sm",onClick:()=>o(`${r.id}`),children:n.jsx(I,{})}),n.jsx(d,{variant:"warning",size:"sm",onClick:()=>o(`update/${r.id}`),children:n.jsx(J,{})}),n.jsx(Z,{id:r.id,code:r.code})]})})]},r.id)),c==="succeeded"&&t.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:8,className:"text-center",children:"Aucun PAP trouvé."})})]})]}),t.length>0&&n.jsx(F,{className:"justify-content-end",children:Array.from({length:_},(r,s)=>n.jsx(F.Item,{active:s===a,onClick:()=>z(s),children:s+1},s))})]})}export{te as default};
