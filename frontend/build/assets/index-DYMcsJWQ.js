import{o as R,a as D,d as q,b as N,j as e,x as u,J as H,D as n,z as B,F as c,a7 as L,cC as P,cD as T,n as p,al as I,cE as G,cF as U,r as S,c9 as M,cG as J,R as Q,y as $,cH as K,cI as O}from"./index-CbhSdBPv.js";const W=({id:l,name:x})=>{const{register:d,handleSubmit:v,setError:g,formState:{errors:a}}=R({defaultValues:{id:l},resolver:L(P)}),[o,m]=D.useState(!1),b=q(),{deleteStatus:t}=N(r=>r.Villes),h=async r=>{try{await b(T(r)).unwrap(),p.success("Ville supprimée avec succès",{autoClose:2e3}),j()}catch(i){g("reason",{message:String(i)})}},j=()=>{m(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(u,{type:"button",variant:"danger",onClick:()=>m(!0),children:e.jsx(H,{})}),o&&e.jsxs(n,{show:o,onHide:j,centered:!0,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsxs(n.Title,{children:["Supprimer la ville ",t==="loading"&&e.jsx(B,{animation:"border",size:"sm"})]})}),e.jsxs(c,{onSubmit:v(h),children:[e.jsxs(n.Body,{className:"p-4",children:[e.jsx("p",{children:"Confirmer la suppression de la ville ?"}),e.jsx("p",{children:x}),e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Raison"}),e.jsxs(c.Select,{...d("reason",{required:"Ce champ est requis"}),children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),a.reason&&e.jsx("span",{className:"text-danger mt-2",children:a.reason.message})]})]}),e.jsx(n.Footer,{children:e.jsxs("div",{className:"d-flex align-items-center gap-3 justify-content-end",children:[e.jsx(u,{variant:"outline-secondary",onClick:j,type:"button",children:"Annuler"}),e.jsx(u,{variant:"danger",type:"submit",children:"Supprimer"})]})})]})]})]})},X=({ville:l})=>{const[x,d]=D.useState(!1),v=q(),{provinces:g}=N(r=>r.province),{updateStatus:a}=N(r=>r.Villes),{register:o,handleSubmit:m,reset:b,formState:{errors:t}}=R({resolver:L(G),defaultValues:{id:l.id,name:l.name,province:l.provinceId}}),h=()=>{b({id:l.id,name:l.name,province:l.provinceId}),d(!1)},j=async r=>{const{id:i,name:y,province:E}=r,C={name:y,province:E};try{await v(U({id:i,...C})).unwrap(),h(),p.success("Ville mise à jour avec succès",{autoClose:2e3})}catch(z){console.error("Échec de la mise à jour de la ville :",z),p.error("Une erreur est survenue lors de la mise à jour de la ville")}};return e.jsxs(e.Fragment,{children:[e.jsx(u,{type:"button",onClick:()=>d(!0),children:e.jsx(I,{})}),x&&e.jsxs(n,{show:x,onHide:h,centered:!0,size:"lg",children:[e.jsx(n.Header,{closeButton:!0,children:e.jsxs(n.Title,{children:["Modifier la ville",a==="loading"&&e.jsx(B,{size:"sm",animation:"border"})]})}),e.jsxs(c,{onSubmit:m(j),children:[e.jsxs(n.Body,{className:"p-4",children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",children:"Nom de la Ville"}),e.jsx("input",{id:"name",className:"form-control my-2",...o("name",{required:"Ce champ est requis"})}),t.name&&e.jsx("div",{className:"text-danger",children:t.name.message})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"province",children:"Province"}),e.jsxs(c.Select,{id:"province",...o("province",{required:"La province est requise"}),children:[e.jsx("option",{value:"",children:"-- Sélectionner une province --"}),g.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),t.province&&e.jsx("div",{className:"text-danger",children:t.province.message})]}),a==="failed"&&e.jsx("p",{className:"text-danger",children:"Une erreur est survenue !"})]}),e.jsxs(n.Footer,{className:"border-0 justify-content-between",children:[e.jsx(u,{variant:"danger",type:"button",onClick:h,children:"Annuler"}),e.jsx(u,{variant:"primary",type:"submit",className:"px-4",children:a==="loading"?e.jsx(B,{animation:"border",size:"sm"}):"Enregistrer"})]})]})]})]})};function Z(){const[l,x]=S.useState(!1),[d,v]=S.useState(""),[g]=S.useState(""),a=q(),{provinces:o}=N(s=>s.province),{cities:m,error:b,status:t}=N(s=>s.Villes),{register:h,handleSubmit:j,reset:r,formState:{errors:i,isSubmitting:y}}=R({resolver:L(O)});S.useEffect(()=>{a(M())},[a]),S.useEffect(()=>{d&&a(J({id:d}))},[a,d]);const E=async s=>{console.log("1111",s);const F={...s};console.log("cityData",F);const f=p.loading("Veuillez patienter...");try{await a(K(F)).unwrap(),p.update(f,{render:"Ville ajoutée avec succès",type:"success",isLoading:!1,autoClose:2e3}),C()}catch(w){p.update(f,{render:String(w),type:"error",isLoading:!1,autoClose:3e3})}},C=()=>{x(!1),r()},z=()=>x(!0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-3",children:[e.jsx("div",{children:e.jsx("span",{className:"fs-4",children:"Liste des villes"})}),e.jsx(u,{variant:"primary",onClick:z,children:"Ajouter une ville"})]}),e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Choisir une province"}),e.jsxs(c.Select,{value:d,onChange:s=>v(s.target.value),children:[e.jsx("option",{value:"",children:"-- Sélectionnez une province --"}),o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx(Q,{children:e.jsx("div",{children:e.jsxs($,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"table-sm",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Nombre de communes"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[t==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:e.jsx(B,{animation:"border",size:"sm",className:"text-primary"})})}),t==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center text-danger",children:b})}),t==="succeeded"&&m.length>0&&m.map((s,F)=>{var f,w;return e.jsxs(D.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:F+1}),e.jsx("td",{children:s.name}),e.jsx("td",{children:((f=s.sectors)==null?void 0:f.length)||0}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[e.jsx(X,{ville:s}),e.jsx(W,{id:s.id,name:s.name})]})})]}),(w=s.sectors)==null?void 0:w.map(V=>{var k;return e.jsx(D.Fragment,{children:e.jsxs("tr",{className:"bg-light",children:[e.jsx("td",{}),e.jsxs("td",{colSpan:2,children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Commune :"})," ",V.name]}),e.jsxs("div",{className:"text-muted small",children:["Réf: ",V.referenceNumber]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Quartier :"}),e.jsx("ul",{children:(k=V.villages)==null?void 0:k.map(A=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Nom :"})," ",A.name]}),e.jsxs("div",{className:"text-muted small",children:["Réf: ",A.referenceNumber]})]},A.id))})]})]}),e.jsx("td",{})]})},V.id)})]},s.id)}),t==="succeeded"&&m.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:"Aucune ville trouvée"})})]})]})})})]}),e.jsxs(n,{show:l,onHide:C,centered:!0,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsx(n.Title,{children:"Ajouter une ville"})}),e.jsx(n.Body,{children:e.jsxs("form",{onSubmit:j(E),children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",children:"Nom"}),e.jsx("input",{id:"name",className:`form-control ${i.name?"is-invalid":""}`,...h("name",{required:"Le nom est obligatoire"})}),i.name&&e.jsx("small",{className:"text-danger",children:i.name.message})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"province",children:"Province"}),e.jsxs(c.Select,{id:"province",...h("province",{required:"La province est obligatoire"}),defaultValue:g,children:[e.jsx("option",{value:"",children:"-- Sélectionnez une province --"}),o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),i.province&&e.jsx("small",{className:"text-danger",children:i.province.message}),i.province&&e.jsx("small",{className:"text-danger",children:i.province.message})]}),e.jsx(u,{variant:"primary",type:"submit",disabled:y,children:y?"Enregistrement...":"Enregistrer"})]})})]})]})}export{Z as default};
