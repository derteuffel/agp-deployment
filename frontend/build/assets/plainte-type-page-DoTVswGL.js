import{o as k,a as w,d as A,b as C,j as e,x as c,J as O,D as a,z,F as b,ak as D,a6 as o,a7 as T,al as R,am as _,r as H,an as U,y as V,n as g,ao as P}from"./index-CyHwfVtD.js";import{u as S,w as q}from"./xlsx-BiIUQI8q.js";import{B as E}from"./Badge-CXXJhtvI.js";const $=({id:n,name:m})=>{const{register:d,handleSubmit:u,setError:l,formState:{errors:h}}=k(),[t,i]=w.useState(!1),p=A(),{deleteStatus:j}=C(r=>r.complaintType),x=async r=>{try{await p(D({id:n,reason:r.reason})).unwrap(),s()}catch{l("reason",{message:"Une erreur est survenue lors de la suppression."})}},s=()=>{i(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(c,{type:"button",variant:"danger",onClick:()=>i(!0),children:e.jsx(O,{})}),t&&e.jsxs(a,{show:t,onHide:s,centered:!0,children:[e.jsx(a.Header,{closeButton:!0,children:e.jsxs(a.Title,{children:["Supprimer Type de plainte",j==="loading"&&e.jsx(z,{animation:"border",className:"ms-3",size:"sm"})]})}),e.jsxs(b,{onSubmit:u(x),children:[e.jsxs(a.Body,{className:"p-4",children:[e.jsx("p",{className:"mb-3",children:"Confirmez-vous la suppression du type de plainte suivant ?"}),e.jsx("p",{className:"fw-bold text-primary",children:m}),e.jsxs(b.Group,{className:"mb-3",children:[e.jsx(b.Label,{children:"Raison"}),e.jsxs(b.Select,{...d("reason",{required:"Ce champ est requis"}),className:`shadow-sm ${h.reason?"is-invalid":""}`,children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),h.reason&&e.jsx("div",{className:"invalid-feedback",children:h.reason.message})]})]}),e.jsx(a.Footer,{children:e.jsxs("div",{className:"d-flex align-items-center gap-3 justify-content-end",children:[e.jsx(c,{variant:"outline-secondary",onClick:s,type:"button",className:"shadow-sm",children:"Annuler"}),e.jsx(c,{variant:"danger",type:"submit",className:"shadow-sm px-4",children:"Supprimer"})]})})]})]})]})},J=o.object({id:o.string(),name:o.string().nonempty("Le nom est requis"),isSensitive:o.enum(["true","false"]).refine(n=>n==="true"||n==="false",{message:"Veuillez sélectionner une valeur valide pour 'Est sensible'"}),isAssetLinked:o.enum(["true","false"]).refine(n=>n==="true"||n==="false",{message:"Veuillez sélectionner une valeur valide pour 'Est lié à un actif'"})}),M=({complaintType:n})=>{const[m,d]=w.useState(!1),u=A(),{register:l,reset:h,handleSubmit:t,formState:{errors:i}}=k({resolver:T(J),defaultValues:{id:n.id,name:n.name,isSensitive:n.isSensitive?"true":"false",isAssetLinked:n.isAssetLinked?"true":"false"}}),p=()=>{d(!1),h()},j=async x=>{try{await u(_({...x,isSensitive:x.isSensitive==="true",isAssetLinked:x.isAssetLinked==="true"})).unwrap(),p()}catch(s){console.error(s)}};return e.jsxs(e.Fragment,{children:[e.jsx(c,{type:"button",onClick:()=>d(!0),className:"shadow-sm",children:e.jsx(R,{})}),m&&e.jsxs(a,{show:m,onHide:p,centered:!0,size:"lg",children:[e.jsx(a.Header,{closeButton:!0,children:e.jsx(a.Title,{children:"Modifier Type de plainte"})}),e.jsxs(b,{onSubmit:t(j),children:[e.jsxs(a.Body,{className:"p-4",children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",children:"Nom"}),e.jsx("input",{id:"name",className:`form-control shadow-sm ${i.name?"is-invalid":""}`,...l("name")}),i.name&&e.jsx("div",{className:"invalid-feedback",children:i.name.message})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"isSensitive",children:"Est sensible"}),e.jsxs("select",{id:"isSensitive",className:`form-control shadow-sm ${i.isSensitive?"is-invalid":""}`,...l("isSensitive"),children:[e.jsx("option",{value:"true",children:"Oui"}),e.jsx("option",{value:"false",children:"Non"})]}),i.isSensitive&&e.jsx("div",{className:"invalid-feedback",children:i.isSensitive.message})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"isAssetLinked",children:"Est lié à un actif"}),e.jsxs("select",{id:"isAssetLinked",className:`form-control shadow-sm ${i.isAssetLinked?"is-invalid":""}`,...l("isAssetLinked"),children:[e.jsx("option",{value:"true",children:"Oui"}),e.jsx("option",{value:"false",children:"Non"})]}),i.isAssetLinked&&e.jsx("div",{className:"invalid-feedback",children:i.isAssetLinked.message})]})]}),e.jsxs(a.Footer,{className:"border-0 justify-content-between",children:[e.jsx(c,{variant:"danger",type:"button",onClick:p,className:"shadow-sm",children:"Annuler"}),e.jsx(c,{variant:"primary",type:"submit",className:"px-4 shadow-sm",children:"Enregistrer"})]})]})]})]})},G=o.object({name:o.string().nonempty("Le nom est requis"),isSensitive:o.enum(["true","false"]).refine(n=>n==="true"||n==="false",{message:"Veuillez sélectionner une valeur valide pour 'Est sensible'"}),isAssetLinked:o.enum(["true","false"]).refine(n=>n==="true"||n==="false",{message:"Veuillez sélectionner une valeur valide pour 'Est lié à un actif'"}).nullable()});function W(){const[n,m]=H.useState(!1),d=A(),{complaintTypes:u}=C(s=>s.complaintType);console.log("########## complaintTypes ",u);const{register:l,handleSubmit:h,formState:{errors:t}}=k({resolver:T(G)});w.useEffect(()=>{d(U())},[d]);const i=async s=>{const r={...s,isSensitive:JSON.parse(s.isSensitive),isAssetLinked:s.isAssetLinked==="true"};console.log("Ajout",r);const f=g.loading("Veuillez patienter...");try{await d(P(r)).unwrap(),g.update(f,{render:"Type de plainte ajouté avec succès",type:"success",isLoading:!1,autoClose:2e3})}catch(y){g.update(f,{render:String(y),type:"error",isLoading:!1,autoClose:6e3})}j()},p=()=>{const s=u.map((N,B)=>({"#":B+1,Nom:N.name,"Est sensible":N.isSensitive?"Oui":"Non","Est lié à un actif":N.isAssetLinked?"Oui":"Non"})),r=S.json_to_sheet(s),f=S.book_new();S.book_append_sheet(f,r,"TypesDePlainte");const y=q(f,{bookType:"xlsx",type:"array"}),F=new Blob([y],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),L=URL.createObjectURL(F),v=document.createElement("a");v.href=L,v.setAttribute("download","types_de_plainte.xlsx"),document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(L)},j=()=>m(!1),x=()=>m(!0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h3",{className:"fw-bold",children:"Liste des types de plainte"}),e.jsx(c,{variant:"primary",onClick:x,className:"shadow-sm",children:"Ajouter un type de plainte"}),e.jsx(c,{variant:"success",onClick:p,className:"shadow-sm ms-2",children:"Exporter en Excel"})]}),e.jsxs(V,{striped:!0,bordered:!0,hover:!0,className:"shadow-sm",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Est sensible"}),e.jsx("th",{children:"Est lié à un actif"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:u.map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:r+1}),e.jsx("td",{children:s.name}),e.jsx("td",{children:e.jsx(E,{bg:s.isSensitive?"danger":"success",children:s.isSensitive?"Oui":"Non"})}),e.jsx("td",{children:e.jsx(E,{bg:s.isAssetLinked?"primary":"secondary",children:s.isAssetLinked?"Oui":"Non"})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[e.jsx(M,{complaintType:s}),e.jsx($,{id:s.id,name:s.name})]})})]},s.id))})]})]}),n&&e.jsxs(a,{show:n,onHide:j,centered:!0,children:[e.jsx(a.Header,{closeButton:!0,children:e.jsx(a.Title,{children:"Ajouter un type de plainte"})}),e.jsx(a.Body,{children:e.jsxs("form",{onSubmit:h(i),className:"p-3",children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Nom"}),e.jsx("input",{id:"name",className:"form-control shadow-sm",...l("name")}),t.name&&e.jsx("p",{className:"text-danger small",children:t.name.message})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"isSensitive",className:"form-label",children:"Est sensible"}),e.jsxs("select",{id:"isSensitive",className:"form-control shadow-sm",...l("isSensitive"),children:[e.jsx("option",{value:"true",children:"Oui"}),e.jsx("option",{value:"false",children:"Non"})]}),t.isSensitive&&e.jsx("p",{className:"text-danger small",children:t.isSensitive.message})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"isAssetLinked",className:"form-label",children:"Est lié à un actif"}),e.jsxs("select",{id:"isAssetLinked",className:"form-control shadow-sm",...l("isAssetLinked"),children:[e.jsx("option",{value:"true",children:"Oui"}),e.jsx("option",{value:"false",children:"Non"})]}),t.isAssetLinked&&e.jsx("p",{className:"text-danger small",children:t.isAssetLinked.message})]}),e.jsx(c,{variant:"primary",type:"submit",className:"w-100 shadow-sm",children:"Enregistrer"})]})})]})]})}export{W as default};
