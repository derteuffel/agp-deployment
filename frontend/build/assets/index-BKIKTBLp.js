import{r as g,d as C,b as w,o as F,j as e,x as l,J as H,D as n,F as a,z as B,a7 as E,cv as L,cw as D,n as S,al as P,cx as G,cy as I,q as M,c9 as q,cz as J,R as U,y as $,a as K,cA as O,cB as Q}from"./index-CyHwfVtD.js";const W=({id:m,name:x})=>{const[r,j]=g.useState(!1),i=C(),{deleteStatus:p}=w(v=>v.territory),{handleSubmit:d,register:f,setError:t,formState:{errors:c}}=F({resolver:E(L),defaultValues:{id:m}}),o=()=>j(!1),h=async v=>{try{await i(D(v)).unwrap(),S.success("Territoire supprimé"),o()}catch(u){t("reason",{message:String(u)})}};return e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"danger",onClick:()=>j(!0),children:e.jsx(H,{})}),e.jsxs(n,{show:r,onHide:o,centered:!0,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsx(n.Title,{children:"Supprimer le territoire"})}),e.jsxs(a,{onSubmit:d(h),children:[e.jsxs(n.Body,{children:[e.jsxs("p",{children:["Voulez-vous vraiment supprimer le territoire ",e.jsx("strong",{children:x})," ?"]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Raison"}),e.jsxs(a.Select,{...f("reason"),children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Created by mistake",children:"Créé par erreur"})]}),c.reason&&e.jsx("div",{className:"text-danger",children:c.reason.message})]})]}),e.jsxs(n.Footer,{children:[e.jsx(l,{variant:"secondary",onClick:o,children:"Annuler"}),e.jsx(l,{variant:"danger",type:"submit",children:p==="loading"?e.jsx(B,{size:"sm"}):"Supprimer"})]})]})]})]})},X=({territory:m})=>{const[x,r]=g.useState(!1),j=C(),{updateStatus:i}=w(h=>h.territory),{register:p,handleSubmit:d,reset:f,formState:{errors:t}}=F({resolver:E(G),defaultValues:{id:m.id,name:m.name}}),c=()=>{f(),r(!1)},o=async h=>{try{await j(I(h)).unwrap(),S.success("Territoire mis à jour avec succès"),c()}catch{S.error("Erreur lors de la mise à jour")}};return e.jsxs(e.Fragment,{children:[e.jsx(l,{onClick:()=>r(!0),children:e.jsx(P,{})}),e.jsxs(n,{show:x,onHide:c,centered:!0,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsx(n.Title,{children:"Modifier le territoire"})}),e.jsxs(a,{onSubmit:d(o),children:[e.jsx(n.Body,{children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Nom"}),e.jsx(a.Control,{...p("name")}),t.name&&e.jsx("div",{className:"text-danger",children:t.name.message})]})}),e.jsxs(n.Footer,{children:[e.jsx(l,{variant:"secondary",onClick:c,children:"Annuler"}),e.jsx(l,{variant:"primary",type:"submit",children:i==="loading"?e.jsx(B,{size:"sm"}):"Enregistrer"})]})]})]})]})};function Z(){const[m,x]=g.useState(!1),[r,j]=g.useState(""),i=C();M();const{provinces:p}=w(s=>s.province),{territories:d,error:f,status:t}=w(s=>s.territory),{register:c,handleSubmit:o,reset:h,watch:v,formState:{errors:u,isSubmitting:z}}=F({resolver:E(Q),defaultValues:{name:"",province:""}});v("province"),g.useEffect(()=>{i(q())},[i]),g.useEffect(()=>{r&&i(J({id:r}))},[i,r]);const k=async s=>{const b=S.loading("Veuillez patienter...");try{await i(O(s)).unwrap(),S.update(b,{render:"Territoire ajouté avec succès",type:"success",isLoading:!1,autoClose:2e3}),A()}catch(N){S.update(b,{render:String(N),type:"error",isLoading:!1,autoClose:3e3})}},A=()=>{x(!1),h()},V=()=>x(!0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-3",children:[e.jsx("span",{className:"fs-4",children:"Liste des territoires"}),e.jsx(l,{variant:"primary",onClick:V,children:"Ajouter un territoire"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Choisir une province"}),e.jsxs(a.Select,{value:r,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"",children:"-- Sélectionnez une province --"}),p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx(U,{children:e.jsxs($,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"table-sm",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Nombre de villages"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[t==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:e.jsx(B,{animation:"border",size:"sm"})})}),t==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center text-danger",children:f})}),t==="succeeded"&&d.length>0&&d.map((s,b)=>{var N,R;return e.jsxs(K.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:b+1}),e.jsx("td",{children:s==null?void 0:s.name}),e.jsx("td",{children:((N=s==null?void 0:s.sectors)==null?void 0:N.length)||0}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[e.jsx(X,{territory:{id:(s==null?void 0:s.id)||"",name:(s==null?void 0:s.name)||""}}),e.jsx(W,{id:(s==null?void 0:s.id)||"",name:(s==null?void 0:s.name)||""})]})})]}),(R=s==null?void 0:s.sectors)==null?void 0:R.map(T=>e.jsxs("tr",{className:"bg-light",children:[e.jsx("td",{}),e.jsxs("td",{colSpan:2,children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Village :"})," ",T.name]}),e.jsxs("div",{className:"text-muted small",children:["Réf: ",T.referenceNumber]})]}),e.jsx("td",{})]},T.id))]},s.id)}),t==="succeeded"&&d.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:"Aucun territoire trouvé"})})]})]})})]}),e.jsxs(n,{show:m,onHide:A,centered:!0,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsx(n.Title,{children:"Ajouter un territoire"})}),e.jsx(n.Body,{children:e.jsxs("form",{onSubmit:o(k),children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",children:"Nom"}),e.jsx("input",{id:"name",className:`form-control ${u.name?"is-invalid":""}`,...c("name")}),u.name&&e.jsx("small",{className:"text-danger",children:u.name.message})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"province",children:"Province"}),e.jsxs(a.Select,{id:"province",...c("province"),defaultValue:"",children:[e.jsx("option",{value:"",children:"-- Sélectionnez une province --"}),p.map(s=>e.jsx("option",{value:s.id||"",children:s.name},s.id))]}),u.province&&e.jsx("small",{className:"text-danger",children:u.province.message})]}),e.jsx(l,{variant:"primary",type:"submit",disabled:z,children:z?"Enregistrement...":"Enregistrer"})]})})]})]})}export{Z as default};
