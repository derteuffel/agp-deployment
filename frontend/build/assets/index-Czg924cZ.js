import{o as D,a as q,d as H,b as L,j as e,x as o,J as M,D as r,z as k,F as v,a7 as R,c4 as G,c5 as $,n as x,al as U,c6 as I,c7 as J,r as h,m as Y,at as K,c8 as O,q as Q,c9 as W,ca as X,R as Z,y as _,cb as ee,cc as se}from"./index-BBwNWda_.js";import{B as te}from"./Badge-BqNBbk6S.js";import{L as V}from"./ListGroup-DENhymIW.js";import"./hook-Ca1-21e-.js";import"./Nav-C9wK4icn.js";const re=({id:l,name:S})=>{const{register:a,handleSubmit:i,setError:d,formState:{errors:p}}=D({defaultValues:{id:l},resolver:R(G)}),[m,n]=q.useState(!1),y=H(),{deleteStatus:j}=L(u=>u.province),f=async u=>{try{await y($(u)).unwrap(),x.success("Province supprimée avec succès",{autoClose:2e3}),g()}catch(b){d("reason",{message:String(b)})}},g=()=>{n(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(o,{type:"button",variant:"danger",onClick:()=>n(!0),children:e.jsx(M,{})}),m&&e.jsxs(r,{show:m,onHide:g,centered:!0,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsxs(r.Title,{children:["Suprimer la province ",j==="loading"&&e.jsx(k,{animation:"border",size:"sm"})]})}),e.jsxs(v,{onSubmit:i(f),children:[e.jsxs(r.Body,{className:"p-4",children:[e.jsx("p",{children:"Confirmer la supression de la province?"}),e.jsx("p",{children:S}),e.jsxs(v.Group,{className:"mb-3",children:[e.jsx(v.Label,{children:"Raison"}),e.jsxs(v.Select,{...a("reason",{required:"Ce champ est requis"}),children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),p.reason&&e.jsx("span",{className:"text-danger mt-2",children:p.reason.message})]})]}),e.jsx(r.Footer,{children:e.jsxs("div",{className:"d-flex align-items-center gap-3 justify-content-end",children:[e.jsx(o,{variant:"outline-secondary",onClick:g,type:"button",children:"Annuler"}),e.jsx(o,{variant:"danger",type:"submit",children:"Supprimer"})]})})]})]})]})},ne=({province:l})=>{const[S,a]=q.useState(!1),i=H(),{updateStatus:d}=L(u=>u.province),{register:p,handleSubmit:m,setError:n,reset:y,formState:{errors:j}}=D({resolver:R(I),defaultValues:{id:l.id,name:l.name}}),f=()=>{y({id:l.id,name:l.name}),a(!1)},g=async u=>{try{await i(J(u)).unwrap(),f(),x.success("Province ajoute avec succes",{autoClose:2e3})}catch(b){console.error("Failed to update province:",b)}};return e.jsxs(e.Fragment,{children:[e.jsx(o,{type:"button",onClick:()=>a(!0),children:e.jsx(U,{})}),S&&e.jsxs(r,{show:S,onHide:f,centered:!0,size:"lg",children:[e.jsx(r.Header,{closeButton:!0,children:e.jsxs(r.Title,{children:["Modifier la province ",d==="loading"&&e.jsx(k,{size:"sm"})]})}),e.jsxs(v,{onSubmit:m(g),children:[e.jsxs(r.Body,{className:"p-4",children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",children:"Nom"}),e.jsx("input",{id:"name",className:"form-control my-2",...p("name",{required:"Ce champ est requis"})}),j.name&&e.jsx("div",{className:"text-danger",children:j.name.message})]}),d==="failed"&&e.jsx("p",{className:"text-danger",children:"une erreur est survenue !"})]}),e.jsxs(r.Footer,{className:"border-0 justify-content-between",children:[e.jsx(o,{variant:"danger",type:"button",onClick:f,children:"Annulé"}),e.jsx(o,{variant:"primary",type:"submit",className:"px-4",children:"Enregistrer"})]})]})]})]})},ae=({selectedProvinces:l,provinceNames:S,onClose:a,show:i})=>{const[d,p]=h.useState(""),[m,n]=h.useState(""),[y,j]=h.useState([]),[f,g]=h.useState(!1),[u,b]=h.useState(!1),[A,C]=h.useState(!1),{user:w}=Y();h.useEffect(()=>{i&&F()},[i]),h.useEffect(()=>{i||(C(!1),p(""),n(""))},[i]);const F=async()=>{g(!0);try{const s=await fetch("https://plaintes.celluleinfra.org/api/v1/project-site",{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error("Erreur lors du chargement des project-sites");const c=await s.json();j(c)}catch(s){x.error(s instanceof Error?s.message:"Erreur lors du chargement des project-sites")}finally{g(!1)}},E=async s=>{if(s.preventDefault(),!d){x.error("Veuillez sélectionner un project-site");return}const c=w==null?void 0:w.token;b(!0);try{const N=await fetch(`https://plaintes.celluleinfra.org/api/v1/project-site/add-to-project-site/${d}?provinces=${l.join(",")}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`}});if(!N.ok){const T=await N.json();throw new Error(T.message||"Erreur lors de l'affectation des provinces au project-site")}x.success("Provinces affectées au project-site avec succès"),a()}catch(N){x.error(N instanceof Error?N.message:"Une erreur est survenue lors de l'affectation")}finally{b(!1)}},B=s=>{const c=s.target.value;if(p(c),c){const N=y.find(T=>T.id===c);n(N?N.name:"")}else n("")},z=s=>{if(s.preventDefault(),!d){x.error("Veuillez sélectionner un project-site");return}C(!0)},P=()=>{C(!1)},t=S.filter(s=>l.includes(s.id));return e.jsxs(r,{show:i,onHide:a,centered:!0,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:A?"Confirmer l'affectation":"Affecter à un project-site"})}),A?e.jsxs(v,{onSubmit:E,children:[e.jsxs(r.Body,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"mb-2",children:"Project-site sélectionné:"}),e.jsx(te,{bg:"primary",className:"fs-6 p-2",children:m})]}),e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-2",children:["Provinces à affecter (",t.length,"):"]}),e.jsx(V,{className:"mb-3",style:{maxHeight:"200px",overflowY:"auto"},children:t.map(s=>e.jsx(V.Item,{className:"d-flex justify-content-between align-items-center",children:s.name},s.id))})]}),e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("strong",{children:"Attention:"}),' Cette action affectera les provinces sélectionnées au project-site "',m,'". Voulez-vous continuer?']})]}),e.jsxs(r.Footer,{children:[e.jsxs(o,{variant:"outline-secondary",onClick:P,children:[e.jsx(K,{className:"me-2"}),"Retour"]}),e.jsx(o,{variant:"secondary",onClick:a,children:"Annuler"}),e.jsx(o,{variant:"success",type:"submit",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(k,{animation:"border",size:"sm",className:"me-2"}),"Affectation..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"me-2"}),"Confirmer l'affectation"]})})]})]}):e.jsxs(v,{onSubmit:z,children:[e.jsxs(r.Body,{children:[e.jsxs("p",{children:["Vous avez sélectionné ",l.length," province(s)"]}),e.jsxs(v.Group,{className:"mb-3",children:[e.jsx(v.Label,{children:"Sélectionner un project-site"}),f?e.jsx("div",{className:"text-center",children:e.jsx(k,{animation:"border",size:"sm"})}):e.jsxs(v.Select,{value:d,onChange:B,required:!0,children:[e.jsx("option",{value:"",children:"-- Sélectionner un project-site --"}),y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs(r.Footer,{children:[e.jsx(o,{variant:"secondary",onClick:a,children:"Annuler"}),e.jsx(o,{variant:"primary",type:"submit",disabled:!d||f,children:"Continuer"})]})]})]})};function ue(){const[l,S]=h.useState(!1),[a,i]=h.useState([]),[d,p]=h.useState(!1),m=H();Q();const{provinces:n,error:y,status:j}=L(t=>t.province),{register:f,handleSubmit:g,reset:u,formState:{errors:b}}=D({resolver:R(se)});h.useEffect(()=>{m(W())},[m]);const A=async t=>{const s=x.loading("Veuillez patienter...");try{await m(ee(t)).unwrap(),x.update(s,{render:"Province ajoutée avec succès",type:"success",isLoading:!1,autoClose:2e3}),C()}catch(c){x.update(s,{render:String(c),type:"error",isLoading:!1,autoClose:3e3})}},C=()=>{S(!1),u()},w=()=>S(!0),F=t=>{i(s=>s.includes(t)?s.filter(c=>c!==t):[...s,t])},E=()=>{a.length===n.length?i([]):i(n.map(t=>t.id))},B=()=>{if(n.filter(s=>a.includes(s.id)).length===0){x.warning("Veuillez sélectionner au moins une province");return}p(!0)},z=()=>{p(!1)},P=n.filter(t=>a.includes(t.id));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-3",children:[e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:"fs-4",children:"Liste des provinces "})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(o,{variant:"success",onClick:B,disabled:P.length===0,className:"w-auto text-center mb-2",children:[e.jsx(X,{className:"me-2"}),"Ajouter dans un tronçon (",P.length,")"]}),e.jsx(o,{variant:"primary",onClick:w,className:"w-auto text-center mb-2",children:"Ajouter une province"})]})]}),e.jsx(Z,{children:e.jsx("div",{children:e.jsxs(_,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"table-sm",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40px"},children:e.jsx("input",{type:"checkbox",checked:a.length>0&&a.length===n.length,onChange:E})}),e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Nombre de villes"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[j==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:e.jsx(k,{animation:"border",size:"sm",className:"text-primary"})})}),j==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-danger",children:y})}),j==="succeeded"&&n.length>0&&n.map((t,s)=>{var c;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:a.includes(t.id),onChange:()=>F(t.id)})}),e.jsx("td",{children:s+1}),e.jsx("td",{children:t.name}),e.jsx("td",{children:((c=t.cities)==null?void 0:c.length)||0}),e.jsx("td",{style:{width:"1%"},children:e.jsxs("div",{className:"d-flex gap-2 align-items-center justify-content-center",children:[e.jsx(ne,{province:t}),e.jsx(re,{id:t.id,name:t.name})]})})]},t.id)}),j==="succeeded"&&n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"Aucune province trouvée"})})]})]})})})]}),l&&e.jsxs(r,{show:l,onHide:C,centered:!0,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:"Ajouter une province"})}),e.jsx(r.Body,{children:e.jsxs("form",{onSubmit:g(A),children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",children:"Nom"}),e.jsx("input",{id:"name",className:"form-control",...f("name")})]}),b.name&&e.jsx("p",{children:b.name.message}),e.jsx(o,{variant:"primary",type:"submit",children:"Enregistrer"})]})})]}),e.jsx(ae,{selectedProvinces:P.map(t=>t.id),provinceNames:n.map(t=>({id:t.id,name:t.name})),show:d,onClose:()=>{z(),i([])}})]})}export{ue as default};
