import{a as T,d as Q,o as R,b as E,j as e,x as c,J as z,D as n,z as S,F as t,a0 as P,H as I,a1 as J,r as i,q as V,m as $,e as K,y as O,a2 as W}from"./index-CyHwfVtD.js";import{C as X}from"./customToast-DPYDVY7W.js";const Y=({id:x,name:j})=>{const[u,h]=T.useState(!1),p=Q(),{register:l,handleSubmit:f,setError:y,formState:{errors:m}}=R(),{deleteStatus:w}=E(a=>a.faq),d=async a=>{try{await p(P({id:x,reason:a.reason})).unwrap(),g()}catch{y("reason",{message:"Une erreur est survenue"})}},g=()=>{h(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(c,{type:"button",variant:"danger",onClick:()=>h(!0),children:e.jsx(z,{})}),u&&e.jsxs(n,{show:u,onHide:g,centered:!0,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsxs(n.Title,{children:["Suprimer la Question ",w==="loading"&&e.jsx(S,{animation:"border"})]})}),e.jsxs(t,{onSubmit:f(d),children:[e.jsxs(n.Body,{className:"p-4",children:[e.jsx("p",{children:"Confirmer la suppression du Question ?"}),e.jsx("p",{children:j}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Raison"}),e.jsxs(t.Select,{...l("reason",{required:!0}),children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),m.reason&&e.jsx("span",{className:"text-danger",children:"Ce champ est requis"})]})]}),e.jsx(n.Footer,{children:e.jsxs("div",{className:"d-flex align-items-center gap-3 justify-content-end",children:[e.jsx(c,{variant:"outline-secondary",onClick:g,type:"button",children:"Annuler"}),e.jsx(c,{variant:"danger",type:"submit",children:"Supprimer"})]})})]})]})]})},Z=({id:x,currentName:j})=>{const[u,h]=T.useState(!1),p=Q(),{register:l,handleSubmit:f,reset:y,setError:m,formState:{errors:w}}=R(),{updateStatus:d}=E(b=>b.faq),g=async b=>{try{await p(J({id:x,name:b.name})).unwrap(),a()}catch{m("name",{message:"Une erreur est survenue"})}},a=()=>{h(!1)};return T.useEffect(()=>{d==="succeeded"&&(a(),y({id:x,name:j}))},[d]),e.jsxs(e.Fragment,{children:[e.jsx(c,{type:"button",variant:"primary",onClick:()=>h(!0),children:e.jsx(I,{})}),u&&e.jsxs(n,{show:u,onHide:a,centered:!0,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsxs(n.Title,{children:["Modifier la Question ",d==="loading"&&e.jsx(S,{animation:"border"})]})}),e.jsxs(t,{onSubmit:f(g),children:[e.jsx(n.Body,{className:"p-4",children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Nom du question"}),e.jsx(t.Control,{type:"text",defaultValue:j,...l("name",{required:!0})}),w.name&&e.jsx("span",{className:"text-danger",children:"Ce champ est requis"})]})}),e.jsx(n.Footer,{children:e.jsxs("div",{className:"d-flex align-items-center gap-3 justify-content-end",children:[e.jsx(c,{variant:"outline-secondary",onClick:a,type:"button",children:"Annuler"}),e.jsx(c,{variant:"primary",type:"submit",children:"Modifier"})]})})]})]})]})};function se(){const{register:x,handleSubmit:j,reset:u}=R(),[h,p]=i.useState(!1),[l,f]=i.useState(""),[y,m]=i.useState(!1),[w,d]=i.useState(""),[g,a]=i.useState(0),[b,C]=i.useState("success"),{loading:N,questions:A}=E(s=>s.faq);V();const[v,k]=i.useState([]),q=Q(),B=()=>p(!0),D=()=>p(!1),{user:F}=$();console.log(F==null?void 0:F.token),i.useEffect(()=>{q(K())},[q]),i.useEffect(()=>{const r=new URLSearchParams(location.search).get("page");r&&a(Number(r))},[location.search]);const H=async s=>{const r={name:s.name,responses:v.filter(o=>o.name.trim()!=="")};try{await q(W(r)).unwrap(),m(!0),d("Faq créé avec succès !"),C("success"),u(),setTimeout(()=>{D()},1e3)}catch(o){m(!0),d(String(o)),C("error")}},L=i.useMemo(()=>l?A.filter(s=>{var r;return(r=s.name)==null?void 0:r.toLowerCase().includes(l.toLowerCase())}):A,[l,A]),M=()=>{k([...v,{name:""}])},G=(s,r)=>{const o=[...v];o[s]={name:r},k(o)};return e.jsxs(e.Fragment,{children:[N?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex justify-content-center",children:[e.jsx(S,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"})," "]})}):e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:"fs-4",children:"Foire Aux Questions"})}),e.jsxs("div",{className:"d-md-flex d-none flex-column flex-md-row gap-2 gap-md-0 justify-content-md-between mb-5",children:[e.jsx(t.Control,{type:"text",placeholder:"Rechercher une question","aria-label":"Rechercher",className:"w-25",value:l,onChange:s=>f(s.target.value)}),e.jsx(c,{variant:"outline-primary",className:"me-2 w-25",onClick:B,children:"Ajouter une question/réponse"})]}),e.jsxs("div",{className:"d-md-none d-flex flex-column  gap-2 gap-md-0 justify-content-md-between mb-5",children:[e.jsx(t.Control,{type:"text",placeholder:"Rechercher un groupe de comité","aria-label":"Rechercher",className:"w-100",value:l,onChange:s=>f(s.target.value)}),e.jsx(c,{variant:"outline-primary",className:"me-2 w-100",onClick:B,children:"Ajouter une question/réponse"})]}),e.jsxs(O,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Question"}),e.jsx("th",{children:"Réponse"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:L.map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),Array.isArray(s.responses)&&s.responses.map((o,U)=>e.jsx("div",{children:o.name},U)),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2 align-items-center justify-content-center",children:[s.id&&s.name&&e.jsx(Z,{id:s.id,currentName:s.name}),s.id&&s.name&&e.jsx(Y,{id:s.id,name:s.name})]})})]},r))})]})]}),e.jsxs(n,{show:h,onHide:D,centered:!0,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsx(n.Title,{children:"Ajouter un question/réponse"})}),e.jsx(n.Body,{children:e.jsxs(t,{onSubmit:j(H),children:[e.jsxs("div",{className:"row mb-2",children:[e.jsxs(t.Group,{controlId:"name",children:[e.jsx(t.Label,{children:"Question"}),e.jsx(t.Control,{...x("name"),required:!0})]}),v.map((s,r)=>e.jsxs(t.Group,{controlId:`answer-${r}`,className:"mt-3",children:[e.jsxs(t.Label,{children:["Réponse ",r+1]}),e.jsx(t.Control,{as:"textarea",rows:3,value:s.name,onChange:o=>G(r,o.target.value),required:!0})]},r)),e.jsx(c,{variant:"outline-primary",className:"mt-3",onClick:M,children:"Ajouter une autre réponse"})]}),e.jsx(c,{variant:"primary",type:"submit",className:"mt-3",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(S,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"})," Enregistrement..."]}):"Enregistrer"})]})})]}),e.jsx(X,{message:w,type:b,show:y,onClose:()=>m(!1)})]})}export{se as default};
