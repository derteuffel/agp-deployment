import{r as x,d as y,o as g,a7 as S,j as e,x as d,D as s,a6 as m,n as l,ac as C,ad as N,b as L,ae as q,y as w,z as A,af as k}from"./index-CbhSdBPv.js";const B=m.object({name:m.string().min(2,"Le nom est requis")});function F({item:u}){const[c,t]=x.useState(!1),r=y(),{register:o,handleSubmit:h,formState:{errors:a}}=g({resolver:S(B),defaultValues:{name:u.name}}),p=async v=>{const n=l.loading("Mise à jour...");try{await r(C({id:u.id,...v})).unwrap(),l.update(n,{render:"Modifié avec succès",type:"success",isLoading:!1,autoClose:2e3}),t(!1)}catch(f){l.update(n,{render:String(f),type:"error",isLoading:!1,autoClose:2e3})}};return e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"outline-primary",size:"sm",onClick:()=>t(!0),children:"Modifier"}),e.jsxs(s,{show:c,onHide:()=>t(!1),centered:!0,children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:"Modifier"})}),e.jsx(s.Body,{children:e.jsxs("form",{onSubmit:h(p),children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",children:"Nom"}),e.jsx("input",{id:"name",className:`form-control ${a.name?"is-invalid":""}`,...o("name")}),a.name&&e.jsx("div",{className:"invalid-feedback",children:a.name.message})]}),e.jsx(d,{type:"submit",variant:"primary",className:"w-100",children:"Mettre à jour"})]})})]})]})}function z({id:u,name:c}){const[t,r]=x.useState(!1),o=y(),h=async()=>{const a=l.loading("Suppression en cours...");try{await o(N({id:u,reason:"Bad data"})).unwrap(),l.update(a,{render:"Supprimé avec succès",type:"success",isLoading:!1,autoClose:2e3}),r(!1)}catch(p){l.update(a,{render:String(p),type:"error",isLoading:!1,autoClose:2e3})}};return e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"outline-danger",size:"sm",onClick:()=>r(!0),children:"Supprimer"}),e.jsxs(s,{show:t,onHide:()=>r(!1),centered:!0,children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:"Confirmation"})}),e.jsxs(s.Body,{children:["Voulez-vous vraiment supprimer ",e.jsx("strong",{children:c})," ?"]}),e.jsxs(s.Footer,{children:[e.jsx(d,{variant:"secondary",onClick:()=>r(!1),children:"Annuler"}),e.jsx(d,{variant:"danger",onClick:h,children:"Supprimer"})]})]})]})}const H=m.object({name:m.string().min(2,"Le nom est requis"),alertLevel:m.string().min(1,"Le niveau d'alerte est requis"),type:m.string().min(1,"Le type est requis")});function T(){const[u,c]=x.useState(!1),t=y(),{items:r,status:o,error:h}=L(i=>i.complaintConsequense),{register:a,handleSubmit:p,reset:v,formState:{errors:n}}=g({resolver:S(H)});x.useEffect(()=>{t(q())},[t]);const f=async i=>{const j=l.loading("Ajout en cours...");try{await t(k(i)).unwrap(),l.update(j,{render:"Ajouté avec succès",type:"success",isLoading:!1,autoClose:2e3}),v(),c(!1)}catch(b){l.update(j,{render:String(b),type:"error",isLoading:!1,autoClose:2e3})}};return e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-4",children:[e.jsx("h3",{children:"Conséquences de la plainte"}),e.jsx(d,{variant:"primary",onClick:()=>c(!0),children:"Ajouter"})]}),e.jsxs(w,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[o==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center",children:e.jsx(A,{animation:"border"})})}),o==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-danger text-center",children:h})}),o==="succeeded"&&r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center",children:"Aucune donnée"})}),o==="succeeded"&&Array.isArray(r)&&r.map((i,j)=>e.jsxs("tr",{children:[e.jsx("td",{children:j+1}),e.jsx("td",{children:i.name}),e.jsxs("td",{children:[e.jsx(F,{item:i}),e.jsx(z,{id:i.id,name:i.name})]})]},i.id))]})]}),e.jsxs(s,{show:u,onHide:()=>c(!1),centered:!0,children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:"Ajouter une conséquence"})}),e.jsx(s.Body,{children:e.jsxs("form",{onSubmit:p(f),children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",children:"Nom"}),e.jsx("input",{id:"name",className:`form-control ${n.name?"is-invalid":""}`,...a("name")}),e.jsx("label",{htmlFor:"alertLevel",children:"Niveau d'alerte"}),e.jsxs("select",{id:"alertLevel",className:`form-control ${n.alertLevel?"is-invalid":""}`,...a("alertLevel"),required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez un niveau d'alerte"}),e.jsx("option",{value:"1",children:"Normal"}),e.jsx("option",{value:"2",children:"Urgent"}),e.jsx("option",{value:"3",children:"Trés urgent"})]}),e.jsx("label",{htmlFor:"type",children:"Type"}),e.jsxs("select",{id:"type",className:`form-control ${n.type?"is-invalid":""}`,...a("type"),required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez un type"}),e.jsx("option",{value:"1",children:"Sensible"}),e.jsx("option",{value:"2",children:"Génerale"})]}),n.name&&e.jsx("div",{className:"invalid-feedback",children:n.name.message}),n.alertLevel&&e.jsx("div",{className:"invalid-feedback",children:n.alertLevel.message}),n.type&&e.jsx("div",{className:"invalid-feedback",children:n.type.message})]}),e.jsx(d,{type:"submit",variant:"primary",className:"w-100",children:"Enregistrer"})]})})]})]})}export{T as default};
