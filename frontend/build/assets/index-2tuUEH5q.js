import{r as c,d as L,b,o as z,j as e,x as v,J as U,D as o,F as r,z as F,a7 as T,cJ as K,cK as O,n as f,cG as H,al as Q,cL as q,cM as W,c9 as X,cz as Y,cN as k,R as Z,y as _,cO as $,cP as ee}from"./index-BBwNWda_.js";const se=({id:i,name:g,onSuccess:d})=>{const[y,a]=c.useState(!1),j=L(),{deleteStatus:n}=b(h=>h.sectors),{handleSubmit:u,register:m,setError:C,formState:{errors:t}}=z({resolver:T(K),defaultValues:{id:i,reason:"Bad data"}}),p=()=>a(!1),S=async h=>{try{await j(O(h)).unwrap(),f.success("Commune supprimée avec succès"),p(),d()}catch(l){C("reason",{message:String(l)})}};return e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"danger",onClick:()=>a(!0),children:e.jsx(U,{})}),e.jsxs(o,{show:y,onHide:p,centered:!0,children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:"Supprimer la commune"})}),e.jsxs(r,{onSubmit:u(S),children:[e.jsxs(o.Body,{children:[e.jsxs("p",{children:["Voulez-vous vraiment supprimer la commune ",e.jsx("strong",{children:g})," ?"]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Raison"}),e.jsxs(r.Select,{...m("reason"),children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Created by mistake",children:"Créée par erreur"})]}),t.reason&&e.jsx("div",{className:"text-danger",children:t.reason.message})]})]}),e.jsxs(o.Footer,{children:[e.jsx(v,{variant:"secondary",onClick:p,children:"Annuler"}),e.jsx(v,{variant:"danger",type:"submit",disabled:n==="loading",children:n==="loading"?e.jsx(F,{size:"sm"}):"Supprimer"})]})]})]})]})},re=({sector:i})=>{const[g,d]=c.useState(!1),y=L();b(l=>l.sectors);const{cities:a}=b(l=>l.Villes),{register:j,handleSubmit:n,reset:u,formState:{errors:m}}=z({resolver:T(q),defaultValues:{id:i.id||"",name:i.name||"",city:i.city||"",territory:i.territory||""}});c.useEffect(()=>{u({id:i.id||"",name:i.name||"",city:i.city||""})},[i,u]),c.useEffect(()=>{i.city&&y(H({id:i.city||""}))},[y,i.city]);const C=()=>{u({id:i.id||"",name:i.name||"",city:i.city||""}),d(!0)},t=()=>{d(!1)},[p,S]=c.useState(!1),h=async l=>{try{S(!0);const x={id:l.id||"",name:l.name||"",city:l.city||"",...l.territory?{territory:l.territory}:{}};await y(W(x)).unwrap(),f.success("Commune mise à jour avec succès"),t()}catch(x){f.error(x instanceof Error?x.message:"Échec de la mise à jour")}finally{S(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"warning",size:"sm",onClick:C,children:e.jsx(Q,{})}),e.jsxs(o,{show:g,onHide:t,centered:!0,children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:"Modifier la commune"})}),e.jsxs(r,{onSubmit:n(h),children:[e.jsxs(o.Body,{children:[e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Nom de la commune"}),e.jsx(r.Control,{...j("name"),className:m.name?"is-invalid":""}),m.name&&e.jsx("div",{className:"invalid-feedback",children:m.name.message})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Ville"}),e.jsxs(r.Select,{...j("city"),className:m.city?"is-invalid":"",children:[e.jsx("option",{value:"",children:"-- Sélectionnez une ville --"}),a.map(l=>e.jsx("option",{value:l.id||"",children:l.name||""},l.id||""))]}),m.city&&e.jsx("div",{className:"invalid-feedback",children:m.city.message})]})]}),e.jsxs(o.Footer,{children:[e.jsx(v,{variant:"secondary",onClick:t,children:"Annuler"}),e.jsx(v,{variant:"primary",type:"submit",disabled:p,children:p?e.jsx(F,{size:"sm"}):"Enregistrer"})]})]})]})]})};function ae(){var I,R;const[i,g]=c.useState(!1),[d,y]=c.useState(""),[a,j]=c.useState(""),[n,u]=c.useState(""),[m,C]=c.useState(!1),t=L(),{provinces:p}=b(s=>s.province),{cities:S}=b(s=>s.Villes),{sectors:h,error:l,status:x}=b(s=>s.sectors),{territories:A}=b(s=>s.territory),{register:B,handleSubmit:D,reset:P,formState:{errors:w,isSubmitting:G}}=z({resolver:T(ee),defaultValues:{name:"",city:""}});c.useEffect(()=>{t(X())},[t]),c.useEffect(()=>{!d||!a||(a==="rural"?t(Y({id:d})):a==="urbain"&&t(H({id:d})),u(""))},[t,d,a]),c.useEffect(()=>{n&&t(k({id:n}))},[t,n]),c.useEffect(()=>{C(!!d&&!!a&&!!n)},[d,a,n]);const M=async s=>{const E=f.loading("Enregistrement en cours...");try{await t($({name:s.name,...a==="rural"?{territory:n}:{city:n}})).unwrap(),f.update(E,{render:"Commune créée avec succès",type:"success",isLoading:!1,autoClose:2e3}),V(),t(k({id:n}))}catch(N){f.update(E,{render:N instanceof Error?N.message:"Erreur lors de la création",type:"error",isLoading:!1,autoClose:3e3})}},V=()=>{g(!1),P()},J=()=>{if(!n){f.warning("Veuillez sélectionner une ville ou un territoire");return}g(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-3",children:[e.jsx("span",{className:"fs-4",children:"Liste des communes"}),e.jsx(v,{variant:"primary",onClick:J,children:"Ajouter une commune"})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Province"}),e.jsxs(r.Select,{value:d,onChange:s=>{y(s.target.value),j(""),u("")},children:[e.jsx("option",{value:"",children:"-- Sélectionnez une province --"}),p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),d&&e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Plus petite entitee"}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx(r.Check,{type:"radio",label:"Rural",name:"type",value:"rural",checked:a==="rural",onChange:()=>j("rural")}),e.jsx(r.Check,{type:"radio",label:"Urbain",name:"type",value:"urbain",checked:a==="urbain",onChange:()=>j("urbain")})]})]}),a==="rural"&&e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Territoire"}),e.jsxs(r.Select,{value:n,onChange:s=>u(s.target.value),children:[e.jsx("option",{value:"",children:"-- Sélectionnez un territoire --"}),A.map(s=>e.jsx("option",{value:s.id||"",children:s.name},s.id))]})]}),a==="urbain"&&e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Ville"}),e.jsxs(r.Select,{value:n,onChange:s=>u(s.target.value),children:[e.jsx("option",{value:"",children:"-- Sélectionnez une ville --"}),S.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx(Z,{children:e.jsxs(_,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"table-sm",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Quartiers"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[x==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:e.jsx(F,{animation:"border",size:"sm"})})}),x==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center text-danger",children:l})}),x==="succeeded"&&h.length>0&&h.map((s,E)=>{var N;return e.jsxs("tr",{children:[e.jsx("td",{children:E+1}),e.jsx("td",{children:s.name}),e.jsx("td",{children:((N=s.villages)==null?void 0:N.length)||0}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[e.jsx(re,{sector:{id:s.id,name:s.name,...a==="rural"?{territory:n}:{city:n}}}),e.jsx(se,{id:s.id,name:s.name,onSuccess:()=>t(k({id:n}))})]})})]},s.id)}),x==="succeeded"&&h.length===0&&n&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:"Aucune commune trouvée"})})]})]})})]}),e.jsxs(o,{show:i,onHide:V,centered:!0,children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:"Ajouter une commune"})}),e.jsx(o.Body,{children:e.jsxs("form",{onSubmit:D(M),children:[e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Nom de la commune"}),e.jsx(r.Control,{...B("name"),isInvalid:!!w.name}),e.jsx(r.Control.Feedback,{type:"invalid",children:(I=w.name)==null?void 0:I.message})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:a==="rural"?"Territoire":"Ville"}),e.jsxs(r.Select,{...B("city"),value:n,onChange:s=>u(s.target.value),isInvalid:!!w.city,children:[e.jsxs("option",{value:"",children:["-- Sélectionnez ",a==="rural"?"un territoire":"une ville"," --"]}),a==="rural"?A.map(s=>e.jsx("option",{value:s.id||"",children:s.name},s.id)):S.map(s=>e.jsx("option",{value:s.id||"",children:s.name},s.id))]}),e.jsx(r.Control.Feedback,{type:"invalid",children:(R=w.city)==null?void 0:R.message})]}),e.jsx(v,{variant:"primary",type:"submit",disabled:G||!n,children:G?"Enregistrement...":"Enregistrer"})]})})]})]})}export{ae as default};
