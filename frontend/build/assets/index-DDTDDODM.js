import{d as D,q as L,b as R,r as l,ap as A,j as e,x as p,z as u,aq as P,F as U,y as _,ar as B}from"./index-CbhSdBPv.js";import{u as x,w as z}from"./xlsx-BiIUQI8q.js";import{I as C}from"./InputGroup-cTVxejvF.js";import{B as $}from"./Badge-PdELC0tt.js";const V=()=>{const j=D(),b=L(),{steps:c,status:h,error:y}=R(s=>s.processingStep),[d,g]=l.useTransition(),[i,N]=l.useState(""),[m,f]=l.useState([]);l.useEffect(()=>{j(A())},[j]),l.useEffect(()=>{if(c&&c.length>0){const s=c.filter(r=>{var t,n;return(((t=r.name)==null?void 0:t.toLowerCase())||"").includes(i.toLowerCase())||(((n=r.referenceNumber)==null?void 0:n.toLowerCase())||"").includes(i.toLowerCase())});f([...s])}else f([])},[c,i]);const w=s=>{N(s.target.value)},S=s=>{g(()=>{b(`/gestion/plainte-process/${s}`)})},k=()=>{g(()=>{b("/gestion/plainte-process/steps")})},F=()=>{if(m.length===0)return;const s=m.map((a,T)=>({"#":T+1,Nom:a.name||"",Position:a.position||0,Référence:a.referenceNumber||"","Délai normal":`${a.deadlineForNormalComplaint||0} jours`,"Délai prioritaire":`${a.deadlineForPriorityComplaint||0} jours`,"Délai urgent":`${a.deadlineForUrgentComplaint||0} jours`})),r=x.json_to_sheet(s),t=x.book_new();x.book_append_sheet(t,r,"Étapes de traitement");const n=z(t,{bookType:"xlsx",type:"array"}),E=new Blob([n],{type:"application/octet-stream"}),v=URL.createObjectURL(E),o=document.createElement("a");o.href=v,o.download="suivi_plainte.xlsx",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(v)};return e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{children:"Tableau de bord de suivi des plaintes"}),e.jsxs(p,{variant:"primary",onClick:k,disabled:d,children:[d?e.jsx(u,{size:"sm",animation:"border",className:"me-2"}):null,"Gérer les étapes de traitement"]}),e.jsx(p,{variant:"success",onClick:F,children:"Export Excel"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs(C,{children:[e.jsx(C.Text,{children:e.jsx(P,{})}),e.jsx(U.Control,{placeholder:"Rechercher par nom ou référence...",value:i,onChange:w})]})}),h==="loading"&&e.jsxs("div",{className:"text-center my-5",children:[e.jsx(u,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Chargement des étapes de traitement..."})]}),h==="failed"&&e.jsxs("div",{className:"alert alert-danger",role:"alert",children:["Erreur: ",y]}),h==="succeeded"&&e.jsxs(_,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{className:"bg-primary text-white",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Position"}),e.jsx("th",{children:"Délai normal"}),e.jsx("th",{children:"Délai prioritaire"}),e.jsx("th",{children:"Délai urgent"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center",children:i?"Aucun résultat trouvé":"Aucune étape de traitement trouvée"})}):m.slice().sort((s,r)=>{const t=s.position||0,n=r.position||0;return t-n}).map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:r+1}),e.jsx("td",{children:s.name||""}),e.jsx("td",{children:e.jsx($,{bg:"info",children:s.position||0})}),e.jsxs("td",{children:[s.deadlineForNormalComplaint||0," jours"]}),e.jsxs("td",{children:[s.deadlineForPriorityComplaint||0," jours"]}),e.jsxs("td",{children:[s.deadlineForUrgentComplaint||0," jours"]}),e.jsx("td",{children:e.jsxs(p,{variant:"primary",size:"sm",onClick:()=>s.id&&S(s.id),disabled:!s.id||d,children:[d?e.jsx(u,{size:"sm",animation:"border",className:"me-1"}):e.jsx(B,{className:"me-1"})," ","Voir"]})})]},s.id||r))})]})]})};export{V as default};
