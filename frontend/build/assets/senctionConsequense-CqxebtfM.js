import{a6 as x,r as m,d as M,b as F,o as z,ag as B,j as e,x as o,y as T,z as D,D as p,F as n,a7 as G,n as r,ah as H,ai as V,aj as R}from"./index-CyHwfVtD.js";const U=x.object({name:x.string().min(2,"Le nom doit contenir au moins 2 caractères"),type:x.number().min(0).max(1,"Le type doit être 0 (sanction) ou 1 (solution)")}),q=()=>{var b,g;const[A,a]=m.useState(!1),[c,j]=m.useState(!1),i=M(),{items:y,status:l,error:C}=F(s=>s.sanctionSolution),S=Array.isArray(y)?y:[],{register:f,handleSubmit:N,reset:v,formState:{errors:d},setValue:h}=z({resolver:G(U),defaultValues:{name:"",type:0}});m.useEffect(()=>{i(B())},[i]);const w=async s=>{const t=r.loading(c?"Mise à jour en cours...":"Création en cours...");try{c&&s.id?(await i(H({id:Number(s.id),...s})).unwrap(),r.update(t,{render:"Mis à jour avec succès",type:"success",isLoading:!1,autoClose:2e3})):(await i(V(s)).unwrap(),r.update(t,{render:"Créé avec succès",type:"success",isLoading:!1,autoClose:2e3})),v(),a(!1)}catch(u){r.update(t,{render:u.message||"Une erreur est survenue",type:"error",isLoading:!1,autoClose:2e3})}},L=async(s,t)=>{if(!window.confirm(`Êtes-vous sûr de vouloir supprimer "${t}" ?`))return;const u=r.loading("Suppression en cours...");try{await i(R(s)).unwrap(),r.update(u,{render:"Supprimé avec succès",type:"success",isLoading:!1,autoClose:2e3})}catch(I){r.update(u,{render:I.message||"Erreur lors de la suppression",type:"error",isLoading:!1,autoClose:2e3})}},E=s=>{h("id",s.id),h("name",s.name),h("type",s.type),j(!0),a(!0)},k=()=>{v(),j(!1),a(!0)};return e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-4 align-items-center",children:[e.jsx("h3",{children:"Sanctions & Solutions"}),e.jsx(o,{variant:"primary",onClick:k,children:"Ajouter"})]}),e.jsxs(T,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[l==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:e.jsx(D,{animation:"border"})})}),l==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-danger text-center",children:C})}),l==="succeeded"&&S.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:"Aucune donnée disponible"})}),l==="succeeded"&&S.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.type===0?"Sanction":"Solution"}),e.jsxs("td",{children:[e.jsx(o,{variant:"outline-primary",size:"sm",className:"me-2",onClick:()=>E(s),children:"Modifier"}),e.jsx(o,{variant:"outline-danger",size:"sm",onClick:()=>L(Number(s.id),s.name),children:"Supprimer"})]})]},s.id))]})]}),e.jsxs(p,{show:A,onHide:()=>a(!1),centered:!0,children:[e.jsx(p.Header,{closeButton:!0,children:e.jsxs(p.Title,{children:[c?"Modifier":"Ajouter"," une sanction/solution"]})}),e.jsx(p.Body,{children:e.jsxs(n,{onSubmit:N(w),children:[e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Nom *"}),e.jsx(n.Control,{type:"text",isInvalid:!!d.name,...f("name")}),e.jsx(n.Control.Feedback,{type:"invalid",children:(b=d.name)==null?void 0:b.message})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Type *"}),e.jsxs(n.Select,{isInvalid:!!d.type,...f("type",{valueAsNumber:!0}),children:[e.jsx("option",{value:"0",children:"Sanction"}),e.jsx("option",{value:"1",children:"Solution"})]}),e.jsx(n.Control.Feedback,{type:"invalid",children:(g=d.type)==null?void 0:g.message})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(o,{variant:"secondary",onClick:()=>a(!1),children:"Annuler"}),e.jsx(o,{variant:"primary",type:"submit",children:c?"Modifier":"Ajouter"})]})]})})]})]})};export{q as default};
