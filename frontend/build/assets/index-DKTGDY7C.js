import{bP as T,a as f,d as y,b as N,o as C,j as e,x as S,al as G,D as c,z as w,F as a,a7 as I,J as H,r as k,aC as M,bQ as $,aX as O,aN as U,R as q,y as J,bR as Q,n as E}from"./index-CbhSdBPv.js";import{P as X,b as _}from"./SpeciesTypes-1YqtMNOJ.js";import{P as F}from"./Pagination-mCE3J0VE.js";import"./Anchor-iNQrUsNx.js";function K(n){return T({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M401.4 224h-214l83-79.4c11.9-12.5 11.9-32.7 0-45.2s-31.2-12.5-43.2 0L89 233.4c-6 5.8-9 13.7-9 22.4v.4c0 8.7 3 16.6 9 22.4l138.1 134c12 12.5 31.3 12.5 43.2 0 11.9-12.5 11.9-32.7 0-45.2l-83-79.4h214c16.9 0 30.6-14.3 30.6-32 .1-18-13.6-32-30.5-32z"},child:[]}]})(n)}const V=({speciePrices:n})=>{const[m,d]=f.useState(!1);y();const{projectSites:b}=N(s=>s.projectSite),{updatePriceStatus:h}=N(s=>s.species),u=X.omit({referenceNumber:!0,slug:!0}),{register:o,handleSubmit:p,reset:t,formState:{errors:l}}=C({resolver:I(u)});f.useEffect(()=>{m&&t({id:n.id,price:n.price,projectSiteId:n.projectSiteId,projectSiteName:n.projectSiteName,speciesId:n.speciesId,speciesName:n.speciesName})},[m,n,t]);const j=()=>{d(!1)},x=async s=>{try{console.log("Updating species price with:",s)}catch(g){console.error("Failed to update species price:",g)}};return e.jsxs(e.Fragment,{children:[e.jsx(S,{type:"button",onClick:()=>d(!0),className:"shadow-sm","aria-label":"Edit Species Price",children:e.jsx(G,{})}),e.jsxs(c,{show:m,onHide:j,centered:!0,children:[e.jsx(c.Header,{closeButton:!0,children:e.jsxs(c.Title,{children:["Modifier une Espèce ",h==="loading"&&e.jsx(w,{size:"sm",className:"ms-2"})]})}),e.jsx(c.Body,{children:e.jsxs("form",{onSubmit:p(x),children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{className:"fw-bold",children:"Tronçons"}),e.jsxs(a.Select,{className:`shadow-sm ${l.projectSiteId?"is-invalid":""}`,...o("projectSiteId"),children:[e.jsx("option",{value:"",children:"Sélectionnez un tronçon"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),l.projectSiteId&&e.jsx("div",{className:"invalid-feedback",children:l.projectSiteId.message})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{htmlFor:"price",className:"fw-bold",children:"Prix"}),e.jsx(a.Control,{id:"price",type:"number",step:"0.01",min:0,placeholder:"Entrez le prix",...o("price",{valueAsNumber:!0}),className:`shadow-sm ${l.price?"is-invalid":""}`}),l.price&&e.jsx("div",{className:"invalid-feedback",children:l.price.message})]}),e.jsx(S,{variant:"primary",type:"submit",className:"w-100 shadow-sm",children:"Enregistrer"})]})})]})]})},W=({id:n,name:m})=>{const[d,b]=f.useState(!1);y();const{deleteStatus:h}=N(x=>x.species),{register:u,handleSubmit:o,setError:p,formState:{errors:t}}=C(),l=async x=>{try{console.log("Deleting:",{id:n,reason:x.reason}),j()}catch{p("reason",{message:"Une erreur est survenue."})}},j=()=>b(!1);return e.jsxs(e.Fragment,{children:[e.jsx(S,{type:"button",variant:"danger",onClick:()=>b(!0),className:"btn-sm shadow-sm","aria-label":"Supprimer l'espèce",children:e.jsx(H,{})}),d&&e.jsxs(c,{show:d,onHide:j,centered:!0,children:[e.jsx(c.Header,{closeButton:!0,children:e.jsx(c.Title,{children:h==="loading"?e.jsxs(e.Fragment,{children:["Suppression en cours ",e.jsx(w,{size:"sm",className:"ms-2"})]}):"Supprimer l'espèce"})}),e.jsxs(a,{onSubmit:o(l),children:[e.jsxs(c.Body,{className:"p-4",children:[e.jsxs("p",{children:["Confirmez-vous la suppression du prix de l'espèce sur le tronçon ",e.jsx("span",{className:"fw-bold text-primary",children:m})," ?"]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{htmlFor:"reason",className:"fw-bold",children:"Raison"}),e.jsxs(a.Select,{id:"reason",...u("reason",{required:"Ce champ est requis."}),className:`shadow-sm ${t.reason?"is-invalid":""}`,children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),t.reason&&e.jsx("div",{className:"invalid-feedback",children:t.reason.message})]})]}),e.jsxs(c.Footer,{children:[e.jsx(S,{variant:"outline-secondary",onClick:j,type:"button",className:"shadow-sm",children:"Annuler"}),e.jsx(S,{variant:"danger",type:"submit",className:"shadow-sm",children:"Supprimer"})]})]})]})]})};function re(){var A;const[n,m]=k.useState(!1),[d,b]=k.useState(1),h=12,{priceId:u}=M(),o=y(),{fetchOneStatus:p,oneSpecies:t,createPriceStatus:l}=N(r=>r.species),{projectSites:j}=N(r=>r.projectSite),x=_.omit({species:!0}),s=C({resolver:I(x)});f.useEffect(()=>{u&&o($(u))},[o,u]),f.useEffect(()=>{o(O())},[o]);const g=()=>{m(!1),s.reset()},B=()=>m(!0),z=Math.ceil((((A=t==null?void 0:t.prices)==null?void 0:A.length)??0)/h),R=r=>{b(r)},P=(d-1)*h,D=P+h,v=t==null?void 0:t.prices.slice(P,D),L=async r=>{try{if(!t)throw new Error("L'élément n'est plus disponible");const i={...r,species:t.id};await o(Q(i)).unwrap(),E.success("Prix ajouté avec succès !",{autoClose:2e3}),g()}catch(i){E.error(String(i),{autoClose:4e3})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mt-4",children:[e.jsx("div",{className:"mb-3",children:e.jsxs(U,{to:"..",className:"text-decoration-none fw-semibold",children:[e.jsx(K,{})," Retour"]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h3",{className:"fw-bold",children:["Liste des prix pour l'espèce : ",e.jsx("span",{className:"text-primary",children:t==null?void 0:t.name})]}),e.jsx(S,{variant:"primary",onClick:B,className:"shadow-sm",children:"Ajouter un prix"})]}),e.jsxs(q,{className:"p-0 m-0",children:[e.jsxs(J,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"shadow-sm",children:[e.jsx("thead",{className:"bg-dark text-white",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Tronçon"}),e.jsx("th",{children:"Espèce"}),e.jsx("th",{children:"Prix"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[p==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:e.jsx(w,{animation:"border",size:"sm",className:"text-primary"})})}),p==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-danger",children:"Une erreur s'est produite lors du chargement des données."})}),p==="succeeded"&&v&&v.length>0&&v.map((r,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:(d-1)*h+i+1}),e.jsx("td",{children:r.projectSiteName}),e.jsx("td",{children:r.speciesName}),e.jsx("td",{children:r.price}),e.jsx("td",{style:{width:"1%"},children:e.jsxs("div",{className:"d-flex gap-2 align-items-center justify-content-center",children:[e.jsx(V,{speciePrices:r}),e.jsx(W,{id:r.id,name:r.projectSiteName})]})})]},r.id)),p==="succeeded"&&(v??[]).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"Aucun prix trouvé"})})]})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(F,{children:Array.from({length:z},(r,i)=>e.jsx(F.Item,{active:i+1===d,onClick:()=>R(i+1),children:i+1},i+1))})})]})]}),n&&e.jsxs(c,{show:n,onHide:g,centered:!0,children:[e.jsx(c.Header,{closeButton:!0,children:e.jsxs(c.Title,{children:["Ajouter un prix ",l==="loading"&&e.jsx(w,{size:"sm",className:"ms-2"})]})}),e.jsx(c.Body,{children:e.jsxs("form",{onSubmit:s.handleSubmit(L),children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{className:"fw-bold",children:"Tronçons"}),e.jsxs(a.Select,{className:`shadow-sm ${s.formState.errors.projectSite?"is-invalid":""}`,...s.register("projectSite"),children:[e.jsx("option",{value:"",children:"Sélectionnez un tronçon"}),j.map((r,i)=>e.jsx("option",{value:r.id,children:r.name},i))]}),s.formState.errors.projectSite&&e.jsx("div",{className:"invalid-feedback",children:s.formState.errors.projectSite.message})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{className:"fw-bold",children:"Prix"}),e.jsx(a.Control,{className:`shadow-sm ${s.formState.errors.price?"is-invalid":""}`,...s.register("price",{valueAsNumber:!0}),type:"number",step:"0.01"}),s.formState.errors.price&&e.jsx("div",{className:"invalid-feedback",children:s.formState.errors.price.message})]}),e.jsx(S,{variant:"primary",type:"submit",className:"shadow-sm w-100",children:"Enregistrer"})]})})]})]})}export{re as default};
