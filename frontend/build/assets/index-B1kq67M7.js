import{a as z,d as B,b as f,o as P,j as e,x,al as Q,D as l,z as T,F as a,aI as W,J as X,aJ as Y,r as I,aK as Z,aL as ee,aM as se,R as te,C as ae,aq as re,y as ne,aN as ie,aO as ce,n as _,a7 as le}from"./index-BBwNWda_.js";import{A as oe}from"./index-BYtINa54.js";import{S as de,C as me}from"./SpeciesTypes-NVQWbwez.js";import{u as U,w as ue}from"./xlsx-BiIUQI8q.js";import{I as H}from"./InputGroup-CONFK0PA.js";import{P as g}from"./Pagination-Dr02RiN_.js";import"./Anchor-B_1sJziF.js";const he=({species:r})=>{const[N,c]=z.useState(!1),y=B(),{units:d}=f(i=>i.units),{updateStatus:j,updateError:m}=f(i=>i.species),{assetTypes:b}=f(i=>i.assetType);de.omit({referenceNumber:!0,slug:!0});const{register:u,handleSubmit:p,setError:v,reset:h,formState:{errors:o}}=P({defaultValues:{id:r.id,name:r.name,prices:r.prices,typeId:r.typeId,typeName:r.typeName,unitId:r.unitId,unitName:r.unitName}}),S=()=>{h({id:r.id,name:r.name,prices:r.prices,typeId:r.typeId,typeName:r.typeName,unitId:r.unitId,unitName:r.unitName}),c(!1)},E=async i=>{const n={name:i.name,type:i.typeId||"",unit:i.unitId||""};try{await y(W({id:i.id,data:n})).unwrap(),S()}catch(F){console.error("Failed to update unit:",F)}};return e.jsxs(e.Fragment,{children:[e.jsx(x,{type:"button",onClick:()=>c(!0),disabled:r.name==="Autres",children:e.jsx(Q,{})}),N&&e.jsxs(l,{show:N,onHide:S,centered:!0,size:"lg",children:[e.jsx(l.Header,{closeButton:!0,children:e.jsxs(l.Title,{children:["Modifier Unité ",j==="loading"&&e.jsx(T,{})]})}),e.jsxs(a,{onSubmit:p(E),children:[e.jsxs(l.Body,{className:"p-4",children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",children:"Nom"}),e.jsx("input",{id:"name",className:"form-control my-2",...u("name",{required:"Ce champ est requis"})}),o.name&&e.jsx("div",{className:"text-danger",children:o.name.message})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Type d'actif"}),e.jsxs(a.Control,{as:"select",...u("typeId",{required:"Le Type d'actif est requis"}),children:[e.jsx("option",{value:"",children:"Sélectionnez un type d'actif"}),b.map((i,n)=>e.jsx("option",{value:i.id,children:i.name},n))]}),o.typeId&&e.jsx("div",{className:"text-danger",children:o.typeId.message})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Unité de mesure"}),e.jsxs(a.Control,{as:"select",...u("unitId",{required:"L'unité de mesure est requise"}),children:[e.jsx("option",{value:"",children:"Sélectionnez une unité de mesure"}),d.map((i,n)=>e.jsx("option",{value:i.id,children:i.name},n))]}),o.unitId&&e.jsx("div",{className:"text-danger",children:o.unitId.message})]}),j==="failed"&&e.jsx("p",{className:"text-danger",children:m})]}),e.jsxs(l.Footer,{className:"border-0 justify-content-between",children:[e.jsx(x,{variant:"danger",type:"button",onClick:S,children:"Annulé"}),e.jsx(x,{variant:"primary",type:"submit",className:"px-4",children:"Enregistrer"})]})]})]})]})},xe=({id:r,name:N})=>{const{register:c,handleSubmit:y,setError:d,formState:{errors:j}}=P(),[m,b]=z.useState(!1),u=B(),{deleteStatus:p}=f(o=>o.species),v=async o=>{try{await u(Y({id:r,reason:o.reason})).unwrap(),h()}catch{d("reason",{message:"Une erreur est survenue lors de la suppression."})}},h=()=>{b(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(x,{type:"button",variant:"danger",onClick:()=>b(!0),disabled:N==="Autres",children:e.jsx(X,{})}),m&&e.jsxs(l,{show:m,onHide:h,centered:!0,children:[e.jsx(l.Header,{closeButton:!0,children:e.jsxs(l.Title,{children:["Supprimer l'espèce",p==="loading"&&e.jsx(T,{size:"sm",className:"ms-2"})]})}),e.jsxs(a,{onSubmit:y(v),children:[e.jsxs(l.Body,{className:"p-4",children:[e.jsx("p",{className:"mb-3",children:"Confirmez-vous la suppression de l'espèce suivante ?"}),e.jsx("p",{className:"fw-bold text-primary",children:N}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{className:"fw-bold",children:"Raison"}),e.jsxs(a.Select,{...c("reason"),className:`shadow-sm ${j.reason?"is-invalid":""}`,children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),j.reason&&e.jsx("div",{className:"invalid-feedback",children:j.reason.message})]})]}),e.jsxs(l.Footer,{className:"border-0 justify-content-between",children:[e.jsx(x,{variant:"outline-secondary",onClick:h,type:"button",className:"shadow-sm",children:"Annuler"}),e.jsx(x,{variant:"danger",type:"submit",className:"shadow-sm px-4",children:"Supprimer"})]})]})]})]})};function ge(){const[r,N]=I.useState(!1),[c,y]=I.useState(1),[d,j]=I.useState(""),[m,b]=I.useState([]),u=12,p=B(),{speciesList:v,status:h,error:o,createStatus:S}=f(s=>s.species),{units:E}=f(s=>s.units),{assetTypes:i}=f(s=>s.assetType),n=P({resolver:le(me)});I.useEffect(()=>{const s=v.filter(t=>{var C,A;return t.name.toLowerCase().includes(d.toLowerCase())||((C=t==null?void 0:t.typeName)==null?void 0:C.toLowerCase().includes(d.toLowerCase()))||((A=t==null?void 0:t.unitName)==null?void 0:A.toLowerCase().includes(d.toLowerCase()))});b(s),y(1)},[d,v]);const F=()=>{const s=m.map((k,K)=>({"#":K+1,"Type d'actif":k.typeName,Nom:k.name,"Unité de mesure":k.name!=="Autres"?k.unitName:"-","Nombre mercuriale":k.prices.length})),t=U.json_to_sheet(s),C=U.book_new();U.book_append_sheet(C,t,"Espèces");const A=ue(C,{bookType:"xlsx",type:"array"}),V=new Blob([A],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),G=URL.createObjectURL(V),R=document.createElement("a");R.href=G,R.download="liste_especes.xlsx",R.click(),URL.revokeObjectURL(G)};z.useEffect(()=>{p(Z()),p(ee()),p(se())},[p]);const D=()=>{N(!1),n.reset()},M=()=>N(!0),L=Math.ceil(m.length/u),w=s=>{y(s)},q=(c-1)*u,O=q+u,$=m.slice(q,O),J=async s=>{try{await p(ce(s)).unwrap(),_.success("Espèce ajoutée avec succès !",{autoClose:2e3}),D()}catch(t){_.error(String(t),{autoClose:4e3})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h3",{className:"fw-bold",children:"Liste des espèces"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(x,{variant:"success",onClick:F,className:"shadow-sm",children:"Exporter en Excel"}),e.jsx(x,{variant:"primary",onClick:M,className:"shadow-sm",children:"Ajouter une espèce"})]})]}),e.jsx(te,{className:"mb-4",children:e.jsx(ae,{md:6,children:e.jsxs(H,{children:[e.jsx(H.Text,{children:e.jsx(re,{})}),e.jsx(a.Control,{type:"text",placeholder:"Rechercher par nom, type ou unité...",value:d,onChange:s=>j(s.target.value)}),d&&e.jsx(x,{variant:"outline-secondary",onClick:()=>j(""),children:"Effacer"})]})})}),e.jsxs("div",{children:[e.jsxs(ne,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"shadow-sm",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Type d'actif"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Unité de mesure"}),e.jsx("th",{children:"Nombre mercuriale"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[h==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:e.jsx(T,{animation:"border",size:"sm",className:"text-primary"})})}),h==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center text-danger",children:o})}),h==="succeeded"&&m.length>0&&$.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:(c-1)*u+t+1}),e.jsx("td",{children:s.typeName}),e.jsx("td",{children:s.name}),e.jsx("td",{className:"text-center",children:s.name!=="Autres"?s.unitName:"-"}),e.jsx("td",{style:{width:"1%"},className:"text-center",children:s.prices.length}),e.jsx("td",{style:{width:"1%"},children:e.jsxs("div",{className:"d-flex gap-2 align-items-center justify-content-center",children:[e.jsx(ie,{to:String(s.id),className:"text-black",children:e.jsx(oe,{size:30})}),e.jsx(he,{species:{id:String(s.id),name:s.name,prices:s.prices,typeId:s.typeId||"",typeName:s.typeName||"",unitId:s.unitId||"",unitName:s.unitName||"",slug:s.slug,referenceNumber:s.referenceNumber}}),e.jsx(xe,{id:String(s.id),name:s.name})]})})]},s.id)),h==="succeeded"&&m.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:d?"Aucune espèce ne correspond à votre recherche":"Aucune espèce trouvée"})})]})]}),m.length>0&&e.jsx("div",{className:"d-flex justify-content-end",children:e.jsxs(g,{children:[e.jsx(g.First,{onClick:()=>w(1),disabled:c===1}),e.jsx(g.Prev,{onClick:()=>w(c-1),disabled:c===1}),Array.from({length:L},(s,t)=>e.jsx(g.Item,{active:t+1===c,onClick:()=>w(t+1),children:t+1},t+1)),e.jsx(g.Next,{onClick:()=>w(c+1),disabled:c===L}),e.jsx(g.Last,{onClick:()=>w(L),disabled:c===L})]})})]})]}),r&&e.jsxs(l,{show:r,onHide:D,centered:!0,children:[e.jsx(l.Header,{closeButton:!0,children:e.jsxs(l.Title,{children:["Créer une Espèce ",S==="loading"&&e.jsx(T,{size:"sm",className:"ms-2"})]})}),e.jsx(l.Body,{children:e.jsxs("form",{onSubmit:n.handleSubmit(J),children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{className:"fw-bold",children:"Nom"}),e.jsx(a.Control,{id:"name",className:`form-control shadow-sm ${n.formState.errors.name?"is-invalid":""}`,...n.register("name")}),n.formState.errors.name&&e.jsx("div",{className:"invalid-feedback",children:n.formState.errors.name.message})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{className:"fw-bold",children:"Type d'actif"}),e.jsxs(a.Select,{className:`shadow-sm ${n.formState.errors.type?"is-invalid":""}`,...n.register("type"),children:[e.jsx("option",{value:"",children:"Sélectionnez un type d'actif"}),i.map((s,t)=>e.jsx("option",{value:s.id,children:s.name},t))]}),n.formState.errors.type&&e.jsx("div",{className:"invalid-feedback",children:n.formState.errors.type.message})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{className:"fw-bold",children:"Unité de mesure"}),e.jsxs(a.Select,{className:`shadow-sm ${n.formState.errors.unit?"is-invalid":""}`,...n.register("unit"),children:[e.jsx("option",{value:"",children:"Sélectionnez une unité de mesure"}),E.map((s,t)=>e.jsx("option",{value:s.id,children:s.name},t))]}),n.formState.errors.unit&&e.jsx("div",{className:"invalid-feedback",children:n.formState.errors.unit.message})]}),e.jsx(x,{variant:"primary",type:"submit",className:"w-100 shadow-sm",children:"Enregistrer"})]})})]})]})}export{ge as default};
