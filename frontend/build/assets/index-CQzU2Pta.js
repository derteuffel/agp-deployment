import{r as C,d as E,b as A,aU as q,o as F,j as e,x as i,al as H,D as r,F as h,z as w,aV as U,J as _,aW as $,a as V,aX as M,y as G,n as N,aY as I}from"./index-CyHwfVtD.js";import{u as k,w as J}from"./xlsx-BiIUQI8q.js";const O=({site:n})=>{const[d,a]=C.useState(!1),t=E(),{updateStatus:m}=A(l=>l.projectSite);q.omit({referenceNumber:!0,slug:!0,villages:!0});const{register:b,handleSubmit:y,setError:g,reset:S,formState:{errors:o}}=F({defaultValues:{id:n.id,name:n.name}}),u=()=>{S({name:n.name,id:n.id}),a(!1)},c=async l=>{try{await t(U(l)).unwrap(),u()}catch(x){g("name",{message:"Une erreur est survenue."}),console.error("Failed to update project site:",x)}};return e.jsxs(e.Fragment,{children:[e.jsx(i,{type:"button",onClick:()=>a(!0),className:"shadow-sm","aria-label":`Modifier le tronçon ${n.name}`,children:e.jsx(H,{})}),d&&e.jsxs(r,{show:d,onHide:u,centered:!0,size:"lg",children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:"Modifier le tronçon"})}),e.jsxs(h,{onSubmit:y(c),children:[e.jsx(r.Body,{children:e.jsxs(h.Group,{className:"mb-3",children:[e.jsx(h.Label,{htmlFor:"name",className:"fw-bold",children:"Nom du tronçon"}),e.jsx(h.Control,{id:"name",type:"text",className:`shadow-sm ${o.name?"is-invalid":""}`,placeholder:"Entrez le nom du tronçon",...b("name",{required:"Ce champ est requis."})}),o.name&&e.jsx("div",{className:"invalid-feedback",children:o.name.message})]})}),e.jsxs(r.Footer,{className:"border-0",children:[e.jsx(i,{variant:"outline-secondary",type:"button",onClick:u,className:"shadow-sm",children:"Annuler"}),e.jsx(i,{variant:"primary",type:"submit",className:"shadow-sm px-4",children:m!=="loading"?"Enregistrer":e.jsxs(e.Fragment,{children:[e.jsx(w,{size:"sm"})," Enregistrement..."]})})]})]})]})]})},W=({id:n,name:d})=>{const[a,t]=C.useState(!1),m=E(),{deleteStatus:b}=A(l=>l.projectSite),{register:y,handleSubmit:g,setError:S,formState:{errors:o}}=F(),u=async l=>{try{await m($({id:n,reason:l.reason})).unwrap(),c()}catch(x){S("reason",{message:"Une erreur est survenue."}),console.error("Delete error:",x)}},c=()=>t(!1);return e.jsxs(e.Fragment,{children:[e.jsx(i,{type:"button",variant:"danger",onClick:()=>t(!0),className:"shadow-sm","aria-label":`Supprimer le tronçon ${d}`,children:e.jsx(_,{})}),a&&e.jsxs(r,{show:a,onHide:c,centered:!0,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsxs(r.Title,{children:["Supprimer le tronçon",b==="loading"&&e.jsx(w,{size:"sm",className:"ms-2"})]})}),e.jsxs(h,{onSubmit:g(u),children:[e.jsxs(r.Body,{children:[e.jsxs("p",{children:["Confirmez-vous la suppression du tronçon ",e.jsx("strong",{className:"text-primary",children:d})," ?"]}),e.jsxs(h.Group,{className:"mb-3",children:[e.jsx(h.Label,{htmlFor:"reason",className:"fw-bold",children:"Raison"}),e.jsxs(h.Select,{id:"reason",...y("reason",{required:"Ce champ est requis."}),className:`shadow-sm ${o.reason?"is-invalid":""}`,children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),o.reason&&e.jsx("div",{className:"invalid-feedback",children:o.reason.message})]})]}),e.jsxs(r.Footer,{className:"border-0",children:[e.jsx(i,{variant:"primary",type:"button",onClick:c,className:"shadow-sm",children:"Annuler"}),e.jsx(i,{variant:"danger",type:"submit",className:"shadow-sm px-4",children:"Supprimer"})]})]})]})]})},K=()=>{const[n,d]=C.useState(!1),a=E(),{projectSites:t,status:m,error:b,createStatus:y}=A(s=>s.projectSite),g=()=>{const s=t.map((z,T)=>{var B;return{"#":T+1,Nom:z.name,Localités:((B=z.provinces)==null?void 0:B.map(R=>R.name).join(", "))||"Aucune localité"}}),j=k.json_to_sheet(s),p=k.book_new();k.book_append_sheet(p,j,"Tronçons");const v=J(p,{bookType:"xlsx",type:"array"}),L=new Blob([v],{type:"application/octet-stream"}),P=URL.createObjectURL(L),f=document.createElement("a");f.href=P,f.setAttribute("download","liste_troncons.xlsx"),document.body.appendChild(f),f.click(),document.body.removeChild(f)},{register:S,handleSubmit:o,reset:u,formState:{errors:c}}=F();V.useEffect(()=>{a(M()),console.log(t)},[a]);const l=async s=>{const j=N.loading("Veuillez patienter...");try{await a(I(s)).unwrap(),N.update(j,{render:"Tronçon ajouté avec succès.",type:"success",isLoading:!1,autoClose:2e3}),x()}catch(p){N.update(j,{render:`Erreur: ${p}`,type:"error",isLoading:!1,autoClose:4e3})}},x=()=>{u(),d(!1)},D=()=>d(!0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h4",{className:"fw-bold",children:"Liste des tronçons routiers"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(i,{variant:"success",onClick:g,className:"shadow-sm",children:"Exporter en Excel"}),e.jsx(i,{variant:"primary",onClick:D,className:"shadow-sm",children:"Ajouter un tronçon"})]})]}),e.jsx("div",{children:e.jsxs(G,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"shadow-sm",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Provinces associées"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[m==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:e.jsx(w,{animation:"border",size:"sm"})})}),m==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center text-danger",children:b||"Erreur de chargement. Veuillez réessayer."})}),m==="succeeded"&&t.length>0&&t.map((s,j)=>e.jsxs("tr",{children:[e.jsx("td",{children:j+1}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.provinces&&s.provinces.length>0?e.jsx("ul",{style:{paddingLeft:"1.2rem",margin:0},children:s.provinces.map((p,v)=>e.jsx("li",{children:p.name},v))}):"Aucune province"}),e.jsx("td",{style:{width:"1%"},children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx(O,{site:s}),e.jsx(W,{id:s.id,name:s.name})]})})]},s.id)),m==="succeeded"&&t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:"Aucun tronçon trouvé."})})]})]})})]}),n&&e.jsxs(r,{show:n,onHide:x,centered:!0,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:"Ajouter un tronçon routier"})}),e.jsx(r.Body,{children:e.jsxs("form",{onSubmit:o(l),children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",className:"fw-bold",children:"Nom du tronçon"}),e.jsx("input",{id:"name",type:"text",className:`form-control shadow-sm ${c.name?"is-invalid":""}`,placeholder:"Entrez le nom du tronçon",...S("name",{required:"Ce champ est requis."})}),c.name&&e.jsx("div",{className:"invalid-feedback",children:c.name.message})]}),e.jsx(i,{type:"submit",variant:"primary",className:"w-100 shadow-sm",children:y!=="loading"?"Enregistrer":e.jsxs(e.Fragment,{children:[e.jsx(w,{size:"sm"})," Enregistrement..."]})})]})})]})]})};export{K as default};
