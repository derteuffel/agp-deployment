import{a as g,d as S,bJ as D,o as A,j as e,x as c,al as U,D as a,F as u,bK as z,b as C,J as H,z as T,a7 as F,bL as _,bM as M,r as O,aM as V,R as $,y as q,n as w,bN as J,bO as G}from"./index-BBwNWda_.js";import{u as v,w as I}from"./xlsx-BiIUQI8q.js";const K=({assetType:t})=>{const[l,n]=g.useState(!1),o=S();D.omit({referenceNumber:!0,slug:!0});const{register:i,handleSubmit:b,setError:d,reset:p,formState:{errors:r}}=A({defaultValues:{id:t.id,name:t.name}}),x=()=>{p({name:t.name,id:t.id}),n(!1)},y=async j=>{try{await o(z(j)).unwrap(),n(!1)}catch(m){d("name",{message:"Une erreur est survenue lors de la mise à jour."}),console.error("Failed to update asset type:",m)}};return e.jsxs(e.Fragment,{children:[e.jsx(c,{type:"button",variant:"primary",onClick:()=>n(!0),children:e.jsx(U,{})}),l&&e.jsxs(a,{show:l,onHide:x,centered:!0,size:"lg",children:[e.jsx(a.Header,{closeButton:!0,children:e.jsx(a.Title,{children:"Modifier Type d'Actif"})}),e.jsxs(u,{onSubmit:b(y),children:[e.jsx(a.Body,{className:"p-4",children:e.jsxs("div",{className:"form-group mb-3",children:[e.jsx(u.Label,{htmlFor:"name",children:"Nom"}),e.jsx(u.Control,{id:"name",className:`shadow-sm ${r.name?"is-invalid":""}`,...i("name",{required:"Le nom est requis."})}),r.name&&e.jsx("div",{className:"invalid-feedback",children:r.name.message})]})}),e.jsxs(a.Footer,{className:"border-0 justify-content-between",children:[e.jsx(c,{variant:"danger",type:"button",onClick:x,className:"shadow-sm",children:"Annuler"}),e.jsx(c,{variant:"primary",type:"submit",className:"shadow-sm px-4",children:"Enregistrer"})]})]})]})]})},P=({id:t,name:l})=>{const{register:n,reset:o,handleSubmit:i,setError:b,formState:{errors:d}}=A({resolver:F(_),defaultValues:{id:t}}),[p,r]=g.useState(!1),x=S(),{deleteStatus:y}=C(s=>s.assetType),j=async s=>{try{await x(M({id:t,reason:s.reason})).unwrap(),m()}catch{b("reason",{message:"Une erreur est survenue lors de la suppression."})}},m=()=>{r(!1),o()};return e.jsxs(e.Fragment,{children:[e.jsx(c,{type:"button",variant:"danger",onClick:()=>r(!0),children:e.jsx(H,{})}),p&&e.jsxs(a,{show:p,onHide:m,centered:!0,children:[e.jsx(a.Header,{closeButton:!0,children:e.jsxs(a.Title,{children:["Supprimer Type d'actif",y==="loading"&&e.jsx(T,{animation:"border",size:"sm",className:"ms-3"})]})}),e.jsxs(u,{onSubmit:i(j),children:[e.jsxs(a.Body,{className:"p-4",children:[e.jsx("p",{className:"mb-3",children:"Confirmez-vous la suppression du type d'actif suivant ?"}),e.jsx("p",{className:"fw-bold text-primary",children:l}),e.jsxs(u.Group,{className:"mb-3",children:[e.jsx(u.Label,{children:"Raison"}),e.jsxs(u.Select,{...n("reason"),className:`shadow-sm ${d.reason?"is-invalid":""}`,children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),d.reason&&e.jsx("div",{className:"invalid-feedback",children:d.reason.message})]})]}),e.jsxs(a.Footer,{className:"border-0 justify-content-between",children:[e.jsx(c,{variant:"primary",onClick:m,type:"button",className:"shadow-sm",children:"Annuler"}),e.jsx(c,{variant:"danger",type:"submit",className:"shadow-sm px-4",children:"Supprimer"})]})]})]})]})};function X(){const[t,l]=O.useState(!1),n=S(),{assetTypes:o,status:i,error:b}=C(s=>s.assetType),{register:d,handleSubmit:p,formState:{errors:r}}=A({resolver:F(G)});g.useEffect(()=>{n(V())},[n]);const x=()=>{const s=o.map((L,R)=>({"#":R+1,Nom:L.name})),h=v.json_to_sheet(s),N=v.book_new();v.book_append_sheet(N,h,"TypesActifs");const E=I(N,{bookType:"xlsx",type:"array"}),B=new Blob([E],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),k=URL.createObjectURL(B),f=document.createElement("a");f.href=k,f.download="types_actifs.xlsx",document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(k)},y=async s=>{const h=w.loading("Veuillez patienter...");try{await n(J(s)).unwrap(),w.update(h,{render:"Type d'actif ajouté avec succès",type:"success",isLoading:!1,autoClose:2e3})}catch(N){w.update(h,{render:String(N),type:"error",isLoading:!1,autoClose:4e3})}j()},j=()=>l(!1),m=()=>l(!0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h3",{className:"fw-bold",children:"Liste des types d'actifs"}),e.jsx(c,{variant:"primary",onClick:m,className:"shadow-sm",children:"Ajouter un type d'actif"}),e.jsx(c,{variant:"success",onClick:x,className:"shadow-sm ms-2",children:"Exporter en Excel"})]}),e.jsx($,{className:"px-0",children:e.jsxs(q,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"shadow-sm",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[i==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center",children:e.jsx(T,{animation:"border",size:"sm",className:"text-primary"})})}),i==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center text-danger",children:b})}),i==="succeeded"&&o.length>0&&o.map((s,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:h+1}),e.jsx("td",{children:s.name}),e.jsx("td",{style:{width:"1%"},children:e.jsxs("div",{className:"d-flex gap-2 align-items-center justify-content-center",children:[e.jsx(K,{assetType:s}),e.jsx(P,{id:s.id,name:s.name})]})})]},s.id)),i==="succeeded"&&o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center",children:"Aucun type d'actif trouvé"})})]})]})})]}),t&&e.jsxs(a,{show:t,onHide:j,centered:!0,children:[e.jsx(a.Header,{closeButton:!0,children:e.jsx(a.Title,{children:"Ajouter un type d'actif"})}),e.jsx(a.Body,{children:e.jsxs("form",{onSubmit:p(y),children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Nom"}),e.jsx("input",{id:"name",className:`form-control shadow-sm ${r.name?"is-invalid":""}`,...d("name")}),r.name&&e.jsx("div",{className:"invalid-feedback",children:r.name.message})]}),e.jsx(c,{variant:"primary",type:"submit",className:"w-100 shadow-sm",children:"Enregistrer"})]})})]})]})}export{X as default};
