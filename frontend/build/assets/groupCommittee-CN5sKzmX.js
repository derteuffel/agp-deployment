import{a as d,d as L,o as R,b as B,j as e,x as l,H as z,D as r,z as S,F as n,Y as O,J,Z as V,N as Y,R as Z,C as $,y as K,n as G,$ as Q}from"./index-CbhSdBPv.js";import{u as A,w as W}from"./xlsx-BiIUQI8q.js";import{P as v}from"./Pagination-mCE3J0VE.js";import"./Anchor-iNQrUsNx.js";const X=({id:g,currentName:f})=>{const[x,u]=d.useState(!1),b=L(),{register:m,handleSubmit:C,reset:a,setError:w,formState:{errors:h}}=R(),{updateStatus:o}=B(p=>p.groupCommitees),c=async p=>{try{await b(O({id:g,name:p.name})).unwrap(),i()}catch{w("name",{message:"Une erreur est survenue"})}},i=()=>{u(!1)};return d.useEffect(()=>{o==="succeeded"&&(i(),a({id:g,name:f}))},[o]),e.jsxs(e.Fragment,{children:[e.jsx(l,{type:"button",variant:"primary",onClick:()=>u(!0),children:e.jsx(z,{})}),x&&e.jsxs(r,{show:x,onHide:i,centered:!0,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsxs(r.Title,{children:["Modifier le groupe de comité ",o==="loading"&&e.jsx(S,{animation:"border"})]})}),e.jsxs(n,{onSubmit:C(c),children:[e.jsx(r.Body,{className:"p-4",children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Nom du groupe"}),e.jsx(n.Control,{type:"text",defaultValue:f,...m("name",{required:!0})}),h.name&&e.jsx("span",{className:"text-danger",children:"Ce champ est requis"})]})}),e.jsx(r.Footer,{children:e.jsxs("div",{className:"d-flex align-items-center gap-3 justify-content-end",children:[e.jsx(l,{variant:"outline-secondary",onClick:i,type:"button",children:"Annuler"}),e.jsx(l,{variant:"primary",type:"submit",children:"Modifier"})]})})]})]})]})},ee=({id:g,name:f})=>{const[x,u]=d.useState(!1),b=L(),{register:m,handleSubmit:C,setError:a,formState:{errors:w}}=R(),{deleteStatus:h}=B(i=>i.groupCommitees),o=async i=>{try{await b(V({id:g,reason:i.reason})).unwrap(),c()}catch{a("reason",{message:"Une erreur est survenue"})}},c=()=>{u(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(l,{type:"button",variant:"danger",onClick:()=>u(!0),children:e.jsx(J,{})}),x&&e.jsxs(r,{show:x,onHide:c,centered:!0,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsxs(r.Title,{children:["Suprimer le groupe de comité ",h==="loading"&&e.jsx(S,{animation:"border"})]})}),e.jsxs(n,{onSubmit:C(o),children:[e.jsxs(r.Body,{className:"p-4",children:[e.jsx("p",{children:"Confirmer la suppression du Groupe de comités ?"}),e.jsx("p",{children:f}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Raison"}),e.jsxs(n.Select,{...m("reason",{required:!0}),children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),w.reason&&e.jsx("span",{className:"text-danger",children:"Ce champ est requis"})]})]}),e.jsx(r.Footer,{children:e.jsxs("div",{className:"d-flex align-items-center gap-3 justify-content-end",children:[e.jsx(l,{variant:"outline-secondary",onClick:c,type:"button",children:"Annuler"}),e.jsx(l,{variant:"danger",type:"submit",children:"Supprimer"})]})})]})]})]})};function ae(){const{register:g,handleSubmit:f,reset:x}=R(),[u,b]=d.useState(!1),[m,C]=d.useState(""),[a,w]=d.useState(1),h=5,{status:o,groupCommittees:c,createError:i,createStatus:p}=B(s=>s.groupCommitees),N=L(),H=()=>b(!0),F=()=>b(!1),_=()=>{const s=j.map(U=>{var D;return{"Nom du groupe":U.name,"Nombre de comités":((D=U.committees)==null?void 0:D.length)||0}}),t=A.json_to_sheet(s),y=A.book_new();A.book_append_sheet(y,t,"Groupes");const q=W(y,{bookType:"xlsx",type:"array"}),I=new Blob([q],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),P=window.URL.createObjectURL(I),E=document.createElement("a");E.href=P,E.download="groupes_commitees.xlsx",E.click(),window.URL.revokeObjectURL(P)};d.useEffect(()=>{N(Y())},[N]);const M=async s=>{const t=G.loading("En cours de création...");try{await N(Q(s)).unwrap(),G.update(t,{render:"Groupe de Comité créé avec succès !",type:"success",isLoading:!1,autoClose:5e3}),x(),F(),window.location.reload()}catch{G.update(t,{render:"Erreur lors de la création du groupe de comité.",type:"error",isLoading:!1,autoClose:5e3})}},j=d.useMemo(()=>Array.isArray(c)?m?c.filter(s=>{var t;return(t=s==null?void 0:s.name)==null?void 0:t.toLowerCase().includes(m.toLowerCase())}):c:[],[m,c]);d.useMemo(()=>{const s=(a-1)*h,t=s+h;return j.slice(s,t)},[j,a,h]);const T=Math.ceil(j.length/h),k=s=>{w(s)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:"fs-4",children:"Liste de groupes de comités"})}),e.jsxs("div",{className:"d-md-flex d-none flex-column flex-md-row gap-2 gap-md-0 justify-content-md-between mb-5",children:[e.jsx(n.Control,{type:"text",placeholder:"Rechercher un groupe de comité","aria-label":"Rechercher",className:"w-25",value:m,onChange:s=>C(s.target.value)}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(l,{variant:"outline-primary",className:"w-100",onClick:H,children:"Ajouter un groupe de comité"}),e.jsx(l,{variant:"success",className:"w-100",onClick:_,children:"Exporter en Excel"})]})]}),e.jsx(Z,{children:e.jsx($,{xs:12,children:e.jsxs(K,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nom du groupe"}),e.jsx("th",{className:"text-center",children:"Nombre de comités"}),e.jsx("th",{className:"text-center",children:"Action"})]})}),e.jsxs("tbody",{children:[o==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center text-primary",children:e.jsx(S,{size:"sm"})})}),o==="succeeded"&&j.length>0&&j.map((s,t)=>{var y;return e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{className:"text-center",children:((y=s.committees)==null?void 0:y.length)||0}),e.jsxs("td",{className:"d-flex gap-2 align-items-center justify-content-center",children:[s.id&&s.name&&e.jsx(X,{id:s.id,currentName:s.name}),s.id&&s.name&&e.jsx(ee,{id:s.id,name:s.name})]})]},t)}),o==="succeeded"&&j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center text-secondary",children:"Aucun groupe de comité trouvé."})}),o==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center text-danger",children:i||"Erreur de chargement des données."})})]})]})})}),e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsxs(v,{children:[e.jsx(v.Prev,{onClick:()=>k(a-1),disabled:a===1}),[...Array(T)].map((s,t)=>e.jsx(v.Item,{active:a===t+1,onClick:()=>k(t+1),children:t+1},t)),e.jsx(v.Next,{onClick:()=>k(a+1),disabled:a===T})]})})]}),u&&e.jsxs(r,{show:u,onHide:F,centered:!0,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:"Ajouter un groupe de comité"})}),e.jsx(r.Body,{children:e.jsxs(n,{onSubmit:f(M),children:[e.jsx("div",{className:"row mb-2",children:e.jsxs(n.Group,{controlId:"name",children:[e.jsx(n.Label,{children:"Nom"}),e.jsx(n.Control,{...g("name"),required:!0})]})}),e.jsx(l,{variant:"primary",type:"submit",className:"mt-3",disabled:p==="loading",children:p==="loading"?e.jsxs(e.Fragment,{children:[e.jsx(S,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"})," Enregistrement..."]}):"Enregistrer"})]})})]})]})}export{ae as default};
