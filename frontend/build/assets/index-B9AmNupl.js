import{a as C,d as S,aQ as z,o as k,j as e,x as i,al as T,D as s,F as m,aR as q,r as U,b as E,J as H,z as A,aS as _,aL as $,R as G,y as M,n as N,aT as V}from"./index-CyHwfVtD.js";import{u as v,w as I}from"./xlsx-BiIUQI8q.js";const J=({unit:o})=>{const[l,t]=C.useState(!1),r=S();z.omit({referenceNumber:!0,slug:!0});const{register:c,handleSubmit:h,setError:b,reset:f,formState:{errors:u}}=k({defaultValues:{id:o.id,name:o.name}}),a=()=>{f({name:o.name,id:o.id}),t(!1)},w=async x=>{try{await r(q(x)).unwrap(),a()}catch(d){b("name",{message:"Une erreur est survenue."}),console.error("Failed to update unit:",d)}};return e.jsxs(e.Fragment,{children:[e.jsx(i,{type:"button",onClick:()=>t(!0),className:"shadow-sm",children:e.jsx(T,{})}),l&&e.jsxs(s,{show:l,onHide:a,centered:!0,size:"lg",children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:"Modifier Unité"})}),e.jsxs(m,{onSubmit:h(w),children:[e.jsx(s.Body,{children:e.jsxs(m.Group,{className:"mb-3",children:[e.jsx(m.Label,{htmlFor:"name",className:"fw-bold",children:"Nom"}),e.jsx(m.Control,{id:"name",type:"text",className:`shadow-sm ${u.name?"is-invalid":""}`,...c("name",{required:"Ce champ est requis."})}),u.name&&e.jsx("div",{className:"invalid-feedback",children:u.name.message})]})}),e.jsxs(s.Footer,{className:"border-0",children:[e.jsx(i,{variant:"danger",type:"button",onClick:a,className:"shadow-sm",children:"Annuler"}),e.jsx(i,{variant:"primary",type:"submit",className:"px-4 shadow-sm",children:"Enregistrer"})]})]})]})]})},O=({id:o,name:l})=>{const[t,r]=U.useState(!1),c=S(),{deleteStatus:h}=E(d=>d.units),{register:b,handleSubmit:f,setError:u,formState:{errors:a}}=k(),w=async d=>{try{await c(_({id:o,reason:d.reason})).unwrap(),x()}catch(g){u("reason",{message:"Une erreur est survenue."}),console.error("Delete error:",g)}},x=()=>r(!1);return e.jsxs(e.Fragment,{children:[e.jsx(i,{type:"button",variant:"danger",onClick:()=>r(!0),className:"shadow-sm","aria-label":`Supprimer l'unité ${l}`,children:e.jsx(H,{})}),t&&e.jsxs(s,{show:t,onHide:x,centered:!0,children:[e.jsx(s.Header,{closeButton:!0,children:e.jsxs(s.Title,{children:["Supprimer l'unité ",h==="loading"&&e.jsx(A,{size:"sm",className:"ms-2"})]})}),e.jsxs(m,{onSubmit:f(w),children:[e.jsxs(s.Body,{children:[e.jsxs("p",{children:["Confirmez-vous la suppression de l'unité ",e.jsx("strong",{children:l})," ?"]}),e.jsxs(m.Group,{className:"mb-3",children:[e.jsx(m.Label,{htmlFor:"reason",className:"fw-bold",children:"Raison"}),e.jsxs(m.Select,{id:"reason",...b("reason",{required:"Ce champ est requis."}),className:`shadow-sm ${a.reason?"is-invalid":""}`,children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),a.reason&&e.jsx("div",{className:"invalid-feedback",children:a.reason.message})]})]}),e.jsxs(s.Footer,{className:"border-0",children:[e.jsx(i,{variant:"primary",onClick:x,className:"shadow-sm",type:"button",children:"Annuler"}),e.jsx(i,{variant:"danger",type:"submit",className:"shadow-sm px-4",children:"Supprimer"})]})]})]})]})};function P(){const[o,l]=U.useState(!1),t=S(),{units:r,status:c,error:h}=E(n=>n.units),{register:b,handleSubmit:f,reset:u,formState:{errors:a}}=k();C.useEffect(()=>{t($())},[t]);const w=()=>{if(!r||r.length===0){N.warning("Aucune donnée à exporter.");return}const n=r.map((D,L)=>({"#":L+1,Nom:D.name})),j=v.json_to_sheet(n),p=v.book_new();v.book_append_sheet(p,j,"Unités");const F=I(p,{bookType:"xlsx",type:"array"}),B=new Blob([F],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),R=URL.createObjectURL(B),y=document.createElement("a");y.href=R,y.download="unites.xlsx",document.body.appendChild(y),y.click(),document.body.removeChild(y)},x=async n=>{const j=N.loading("Veuillez patienter...");try{await t(V(n)).unwrap(),N.update(j,{render:"Unité ajoutée avec succès.",type:"success",isLoading:!1,autoClose:2e3}),d()}catch(p){N.update(j,{render:p instanceof Error?p.message:String(p),type:"error",isLoading:!1,autoClose:4e3})}},d=()=>{u(),l(!1)},g=()=>l(!0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h4",{className:"fw-bold",children:"Liste des unités de mesure"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(i,{variant:"success",onClick:w,className:"shadow-sm",children:"Exporter en Excel"}),e.jsx(i,{variant:"primary",onClick:g,className:"shadow-sm",children:"Ajouter une unité"})]})]}),e.jsx(G,{children:e.jsx("div",{children:e.jsxs(M,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"shadow-sm",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsxs("tbody",{children:[c==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center",children:e.jsx(A,{animation:"border",size:"sm"})})}),c==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center text-danger",children:typeof h=="string"?h:h||"Une erreur s'est produite."})}),c==="succeeded"&&r.length>0&&r.map((n,j)=>e.jsxs("tr",{children:[e.jsx("td",{children:j+1}),e.jsx("td",{children:n.name}),e.jsx("td",{style:{width:"1%"},children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx(J,{unit:n}),e.jsx(O,{id:n.id,name:n.name})]})})]},n.id)),c==="succeeded"&&r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center",children:"Aucune unité trouvée."})})]})]})})})]}),e.jsxs(s,{show:o,onHide:d,centered:!0,children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:"Ajouter une unité de mesure"})}),e.jsx(s.Body,{children:e.jsxs("form",{onSubmit:f(x),children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",className:"fw-bold",children:"Nom de l'unité"}),e.jsx("input",{id:"name",className:`form-control shadow-sm ${a.name?"is-invalid":""}`,placeholder:"Entrez le nom de l'unité",...b("name",{required:"Ce champ est requis."})}),a.name&&e.jsx("div",{className:"invalid-feedback",children:a.name.message})]}),e.jsx(i,{type:"submit",variant:"primary",className:"w-100 shadow-sm",children:"Enregistrer"})]})})]})]})}export{P as default};
