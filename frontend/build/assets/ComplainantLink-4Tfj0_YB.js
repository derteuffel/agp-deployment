import{a6 as y,r as f,d as g,o as S,a7 as b,j as e,x as o,D as s,n as r,a8 as w,a9 as N,b as A,aa as k,y as B,z as F,ab as H}from"./index-CyHwfVtD.js";const v=y.object({id:y.string().nullable().default(""),name:y.string().min(2,"Le nom est requis")});function z({link:t}){const[l,i]=f.useState(!1),c=g(),{register:n,handleSubmit:m,formState:{errors:d}}=S({resolver:b(v),defaultValues:{name:t.name}}),u=async h=>{const p=r.loading("Mise à jour en cours...");try{await c(w({id:t.id,name:h.name})).unwrap(),r.update(p,{render:"Lien mis à jour",type:"success",isLoading:!1}),i(!1)}catch(j){r.update(p,{render:String(j),type:"error",isLoading:!1})}};return e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline-primary",size:"sm",onClick:()=>i(!0),children:"Modifier"}),e.jsxs(s,{show:l,onHide:()=>i(!1),centered:!0,children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:"Modifier lien de parenté"})}),e.jsx(s.Body,{children:e.jsxs("form",{onSubmit:m(u),children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",children:"Nom"}),e.jsx("input",{id:"name",className:`form-control ${d.name?"is-invalid":""}`,...n("name")}),d.name&&e.jsx("div",{className:"invalid-feedback",children:d.name.message})]}),e.jsx(o,{type:"submit",variant:"primary",className:"w-100",children:"Enregistrer les modifications"})]})})]})]})}function E({id:t,name:l}){const i=g(),[c,n]=f.useState(!1),m=async()=>{const d=r.loading("Suppression en cours...");try{await i(N({id:t,reason:"Bad data"})).unwrap(),r.update(d,{render:"Lien supprimé",type:"success",isLoading:!1}),n(!1)}catch(u){r.update(d,{render:String(u),type:"error",isLoading:!1})}};return e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline-danger",size:"sm",onClick:()=>n(!0),children:"Supprimer"}),e.jsxs(s,{show:c,onHide:()=>n(!1),centered:!0,children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:"Confirmer la suppression"})}),e.jsx(s.Body,{children:e.jsxs("p",{children:["Voulez-vous vraiment supprimer ",e.jsx("strong",{children:l})," ?"]})}),e.jsxs(s.Footer,{children:[e.jsx(o,{variant:"secondary",onClick:()=>n(!1),children:"Annuler"}),e.jsx(o,{variant:"danger",onClick:m,children:"Supprimer"})]})]})]})}function M(){const t=g(),[l,i]=f.useState(!1),{complainantLinks:c,status:n,error:m}=A(a=>a.complainantLink),{register:d,handleSubmit:u,formState:{errors:h}}=S({resolver:b(v)});f.useEffect(()=>{t(k())},[t]);const p=async a=>{const x=r.loading("Ajout en cours...");try{await t(H(a)).unwrap(),r.update(x,{render:"Lien de parenté ajouté !",type:"success",isLoading:!1,autoClose:2e3}),j()}catch(C){r.update(x,{render:String(C),type:"error",isLoading:!1,autoClose:2e3})}},j=()=>i(!1),L=()=>i(!0);return e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-4",children:[e.jsx("h3",{children:"Liens de parenté"}),e.jsx(o,{variant:"primary",onClick:L,children:"Ajouter"})]}),e.jsxs(B,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[n==="loading"&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center",children:e.jsx(F,{animation:"border"})})}),n==="failed"&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-danger text-center",children:m})}),n==="succeeded"&&Array.isArray(c)&&c.map((a,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:x+1}),e.jsx("td",{children:a.name}),e.jsxs("td",{children:[e.jsx(z,{link:{id:a.id||"",name:a.name||""}}),e.jsx(E,{id:a.id||"",name:a.name||""})]})]},a.id))]})]}),e.jsxs(s,{show:l,onHide:j,centered:!0,children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:"Ajouter un lien de parenté"})}),e.jsx(s.Body,{children:e.jsxs("form",{onSubmit:u(p),children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",children:"Nom"}),e.jsx("input",{id:"name",className:`form-control ${h.name?"is-invalid":""}`,...d("name")}),h.name&&e.jsx("div",{className:"invalid-feedback",children:h.name.message})]}),e.jsx(o,{type:"submit",variant:"primary",className:"w-100",children:"Enregistrer"})]})})]})]})}export{M as default};
