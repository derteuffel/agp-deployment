import{r as m,d as I,b as L,q as M,o as T,a7 as z,j as e,x as c,H as W,D as l,F as r,z as P,n as p,as as X,ap as f,at as Y,au as Z,y as _,av as ee,aw as re,ax as ae}from"./index-CyHwfVtD.js";import{u as ne,c as te,d as ie}from"./processingStepTypes-BD-Dz-18.js";const se=({step:t,onUpdate:j,complaintId:b})=>{const[F,x]=m.useState(!1),y=I(),{updateStatus:S}=L(d=>d.processingStep),v=M(),{register:u,handleSubmit:D,reset:g,formState:{errors:n}}=T({resolver:z(ne),defaultValues:{name:t.name||"",position:t.position||1,deadlineForNormalComplaint:t.deadlineForNormalComplaint||10,deadlineForPriorityComplaint:t.deadlineForPriorityComplaint||5,deadlineForUrgentComplaint:t.deadlineForUrgentComplaint||3}});m.useEffect(()=>{t&&g({name:t.name||"",position:t.position||1,deadlineForNormalComplaint:t.deadlineForNormalComplaint||10,deadlineForPriorityComplaint:t.deadlineForPriorityComplaint||5,deadlineForUrgentComplaint:t.deadlineForUrgentComplaint||3})},[t,g]);const C=()=>{g({name:t.name||"",position:t.position||1,deadlineForNormalComplaint:t.deadlineForNormalComplaint||10,deadlineForPriorityComplaint:t.deadlineForPriorityComplaint||5,deadlineForUrgentComplaint:t.deadlineForUrgentComplaint||3}),x(!0)},h=()=>{x(!1)},U=async d=>{if(!t.id){p.error("ID de l'étape manquant");return}try{const o={...d,position:Number(d.position),deadlineForNormalComplaint:Number(d.deadlineForNormalComplaint),deadlineForPriorityComplaint:Number(d.deadlineForPriorityComplaint),deadlineForUrgentComplaint:Number(d.deadlineForUrgentComplaint)};console.log("Updating step with ID:",t.id,"and data:",o),await y(X({id:t.id,data:o})).unwrap(),p.success("Étape de traitement mise à jour avec succès"),h(),j&&j(),b&&v(`/apps/tracking/${b}`)}catch(o){console.error("Update error:",o),p.error(`Erreur: ${(o==null?void 0:o.message)||JSON.stringify(o)}`)}};return e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"warning",size:"sm",onClick:C,children:e.jsx(W,{})}),e.jsxs(l,{show:F,onHide:h,centered:!0,children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Modifier l'étape de traitement"})}),e.jsxs(r,{onSubmit:D(U),children:[e.jsxs(l.Body,{children:[e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Nom de l'étape"}),e.jsx(r.Control,{type:"text",...u("name"),isInvalid:!!n.name,placeholder:"Entrez le nom de l'étape"}),n.name&&e.jsx(r.Text,{className:"text-danger",children:n.name.message}),e.jsx(r.Text,{className:"text-muted",children:"Le nom de l'étape doit être unique."})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Position"}),e.jsx(r.Control,{type:"number",...u("position",{valueAsNumber:!0}),isInvalid:!!n.position,placeholder:"Entrez la position de l'étape"}),n.position&&e.jsx(r.Text,{className:"text-danger",children:n.position.message})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Délai pour plainte normale (jours)"}),e.jsx(r.Control,{type:"number",...u("deadlineForNormalComplaint",{valueAsNumber:!0}),isInvalid:!!n.deadlineForNormalComplaint,placeholder:"Entrez le délai en jours"}),n.deadlineForNormalComplaint&&e.jsx(r.Text,{className:"text-danger",children:n.deadlineForNormalComplaint.message})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Délai pour plainte prioritaire (jours)"}),e.jsx(r.Control,{type:"number",...u("deadlineForPriorityComplaint",{valueAsNumber:!0}),isInvalid:!!n.deadlineForPriorityComplaint,placeholder:"Entrez le délai en jours"}),n.deadlineForPriorityComplaint&&e.jsx(r.Text,{className:"text-danger",children:n.deadlineForPriorityComplaint.message})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Délai pour plainte urgente (jours)"}),e.jsx(r.Control,{type:"number",...u("deadlineForUrgentComplaint",{valueAsNumber:!0}),isInvalid:!!n.deadlineForUrgentComplaint,placeholder:"Entrez le délai en jours"}),n.deadlineForUrgentComplaint&&e.jsx(r.Text,{className:"text-danger",children:n.deadlineForUrgentComplaint.message})]})]}),e.jsxs(l.Footer,{children:[e.jsx(c,{variant:"secondary",onClick:h,children:"Annuler"}),e.jsx(c,{variant:"primary",type:"submit",disabled:S==="loading",children:S==="loading"?e.jsx(P,{size:"sm",animation:"border"}):"Enregistrer"})]})]})]})]})},de=()=>{const[t,j]=m.useState(!1),[b,F]=m.useState(!1),[x,y]=m.useState(null),[S,v]=m.useState(null),[u,D]=m.useTransition(),g=M(),n=I(),{steps:C,status:h,error:U,createStatus:d,deleteStatus:o}=L(a=>a.processingStep),{register:N,handleSubmit:B,reset:G,formState:{errors:s}}=T({resolver:z(te),defaultValues:{name:"",position:1,deadlineForNormalComplaint:10,deadlineForPriorityComplaint:5,deadlineForUrgentComplaint:3}}),{register:k,handleSubmit:H,reset:O,formState:{errors:w}}=T({resolver:z(ie)});m.useEffect(()=>{n(f())},[n]);const q=()=>j(!0),E=()=>{j(!1),G()},$=(a,i)=>{y(a),v(i),F(!0)},A=()=>{F(!1),y(null),v(null),O()},J=()=>{D(()=>{g("/gestion/plainte-process")})},R=async a=>{try{const i={...a,position:Number(a.position),deadlineForNormalComplaint:Number(a.deadlineForNormalComplaint),deadlineForPriorityComplaint:Number(a.deadlineForPriorityComplaint),deadlineForUrgentComplaint:Number(a.deadlineForUrgentComplaint)};await n(re(i)).unwrap(),p.success("Étape de traitement créée avec succès"),E(),n(f())}catch(i){console.error("Create error:",i),p.error(`Erreur: ${(i==null?void 0:i.message)||JSON.stringify(i)}`)}},V=async a=>{if(!x){p.error("ID de l'étape manquant");return}try{console.log("Deleting step with ID:",x,"and reason:",a.reason),await n(ae({id:x,reason:a.reason})).unwrap(),p.success("Étape de traitement supprimée avec succès"),A(),n(f())}catch(i){console.error("Delete error:",i),p.error(`Erreur: ${(i==null?void 0:i.message)||JSON.stringify(i)}`)}};return e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs(c,{variant:"outline-secondary",className:"me-3",onClick:J,disabled:u,children:[e.jsx(Y,{className:"me-1"})," Retour"]}),e.jsx("h2",{children:"Étapes de traitement des plaintes"})]}),e.jsxs(c,{variant:"primary",onClick:q,children:[e.jsx(Z,{className:"me-2"})," Ajouter une étape"]})]}),h==="loading"&&e.jsxs("div",{className:"text-center my-5",children:[e.jsx(P,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Chargement des étapes de traitement..."})]}),h==="failed"&&e.jsxs("div",{className:"alert alert-danger",role:"alert",children:["Erreur: ",U]}),h==="succeeded"&&e.jsxs(_,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{className:"bg-primary text-white",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Position"}),e.jsx("th",{children:"Délai normal (jours)"}),e.jsx("th",{children:"Délai prioritaire (jours)"}),e.jsx("th",{children:"Délai urgent (jours)"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:!C||C.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center",children:"Aucune étape de traitement trouvée"})}):[...C].sort((a,i)=>{const K=a.position||0,Q=i.position||0;return K-Q}).map((a,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:i+1}),e.jsx("td",{children:a.name||""}),e.jsx("td",{children:a.position||0}),e.jsx("td",{children:a.deadlineForNormalComplaint||0}),e.jsx("td",{children:a.deadlineForPriorityComplaint||0}),e.jsx("td",{children:a.deadlineForUrgentComplaint||0}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(se,{step:a,onUpdate:()=>n(f())}),e.jsx(c,{variant:"danger",size:"sm",onClick:()=>$(a.id||"",a.name||""),disabled:!a.id,children:e.jsx(ee,{})})]})})]},a.id||i))})]}),e.jsxs(l,{show:t,onHide:E,centered:!0,children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Ajouter une étape de traitement"})}),e.jsxs(r,{onSubmit:B(R),children:[e.jsxs(l.Body,{children:[e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Nom de l'étape"}),e.jsx(r.Control,{type:"text",...N("name"),isInvalid:!!s.name,placeholder:"Entrez le nom de l'étape"}),s.name&&e.jsx(r.Text,{className:"text-danger",children:s.name.message})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Position"}),e.jsx(r.Control,{type:"number",...N("position",{valueAsNumber:!0}),isInvalid:!!s.position,placeholder:"Entrez la position de l'étape"}),s.position&&e.jsx(r.Text,{className:"text-danger",children:s.position.message})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Délai pour plainte normale (jours)"}),e.jsx(r.Control,{type:"number",...N("deadlineForNormalComplaint",{valueAsNumber:!0}),isInvalid:!!s.deadlineForNormalComplaint,placeholder:"Entrez le délai en jours"}),s.deadlineForNormalComplaint&&e.jsx(r.Text,{className:"text-danger",children:s.deadlineForNormalComplaint.message})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Délai pour plainte prioritaire (jours)"}),e.jsx(r.Control,{type:"number",...N("deadlineForPriorityComplaint",{valueAsNumber:!0}),isInvalid:!!s.deadlineForPriorityComplaint,placeholder:"Entrez le délai en jours"}),s.deadlineForPriorityComplaint&&e.jsx(r.Text,{className:"text-danger",children:s.deadlineForPriorityComplaint.message})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Délai pour plainte urgente (jours)"}),e.jsx(r.Control,{type:"number",...N("deadlineForUrgentComplaint",{valueAsNumber:!0}),isInvalid:!!s.deadlineForUrgentComplaint,placeholder:"Entrez le délai en jours"}),s.deadlineForUrgentComplaint&&e.jsx(r.Text,{className:"text-danger",children:s.deadlineForUrgentComplaint.message})]})]}),e.jsxs(l.Footer,{children:[e.jsx(c,{variant:"secondary",onClick:E,children:"Annuler"}),e.jsx(c,{variant:"primary",type:"submit",disabled:d==="loading",children:d==="loading"?e.jsx(P,{size:"sm",animation:"border"}):"Enregistrer"})]})]})]}),e.jsxs(l,{show:b,onHide:A,centered:!0,children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Supprimer l'étape de traitement"})}),e.jsxs(r,{onSubmit:H(V),children:[e.jsxs(l.Body,{children:[e.jsxs("p",{children:["Êtes-vous sûr de vouloir supprimer l'étape ",e.jsx("strong",{children:S})," ?"]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Raison de la suppression"}),e.jsxs(r.Select,{...k("reason"),isInvalid:!!w.reason,children:[e.jsx("option",{value:"",children:"-- Sélectionnez une raison --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),w.reason&&e.jsx(r.Text,{className:"text-danger",children:w.reason.message})]})]}),e.jsxs(l.Footer,{children:[e.jsx(c,{variant:"secondary",onClick:A,children:"Annuler"}),e.jsx(c,{variant:"danger",type:"submit",disabled:o==="loading",children:o==="loading"?e.jsx(P,{size:"sm",animation:"border"}):"Supprimer"})]})]})]})]})};export{de as default};
