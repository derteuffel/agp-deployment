import{a6 as N,a as k,b as w,d as C,o as F,a7 as R,j as e,x as l,al as I,D as a,F as d,aE as q,J as z,z as D,aF as H,r as U,aG as _,an as $,R as V,y as G,n as g,aH as M}from"./index-CbhSdBPv.js";import{u as S,w as O}from"./xlsx-BiIUQI8q.js";const J=N.object({id:N.string(),name:N.string().nonempty("Le nom est requis."),typeId:N.string().nonempty("Le type de plainte est requis.")}),K=({prejudice:n})=>{const[c,o]=k.useState(!1),{complaintTypes:y}=w(r=>r.complaintType),p=C(),{register:m,handleSubmit:h,setError:j,reset:t,formState:{errors:i}}=F({resolver:R(J),defaultValues:{typeId:n.typeId,id:n.id,name:n.name}}),u=()=>{t({typeId:n.typeId,id:n.id,name:n.name}),o(!1)},x=async r=>{try{await p(q(r)).unwrap(),u()}catch(s){j("name",{message:"Une erreur est survenue lors de la mise à jour."}),console.error("Failed to update prejudice:",s)}};return e.jsxs(e.Fragment,{children:[e.jsx(l,{type:"button",variant:"primary",onClick:()=>o(!0),children:e.jsx(I,{})}),c&&e.jsxs(a,{show:c,onHide:u,centered:!0,size:"lg",children:[e.jsx(a.Header,{closeButton:!0,children:e.jsx(a.Title,{children:"Modifier Préjudice"})}),e.jsxs(d,{onSubmit:h(x),children:[e.jsxs(a.Body,{className:"p-4",children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx(d.Label,{htmlFor:"name",children:"Nom"}),e.jsx(d.Control,{id:"name",className:`shadow-sm ${i.name?"is-invalid":""}`,...m("name")}),i.name&&e.jsx("div",{className:"invalid-feedback",children:i.name.message})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsx(d.Label,{htmlFor:"type",children:"Type"}),e.jsxs(d.Select,{id:"type",className:`shadow-sm ${i.typeId?"is-invalid":""}`,...m("typeId"),children:[e.jsx("option",{value:"",children:"-- Choisir un type de plainte --"}),y.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),i.typeId&&e.jsx("div",{className:"invalid-feedback",children:i.typeId.message})]})]}),e.jsxs(a.Footer,{className:"border-0 justify-content-between",children:[e.jsx(l,{variant:"outline-secondary",type:"button",onClick:u,className:"shadow-sm",children:"Annuler"}),e.jsx(l,{variant:"primary",type:"submit",className:"shadow-sm px-4",children:"Enregistrer"})]})]})]})]})},Q=({id:n,name:c})=>{const{register:o,reset:y,handleSubmit:p,setError:m,formState:{errors:h}}=F(),[j,t]=k.useState(!1),i=C(),{deleteStatus:u}=w(s=>s.prejudice),x=async s=>{try{await i(H({id:n,reason:s.reason})).unwrap(),r()}catch{m("reason",{message:"Une erreur est survenue lors de la suppression."})}},r=()=>{t(!1),y()};return e.jsxs(e.Fragment,{children:[e.jsx(l,{type:"button",variant:"danger",onClick:()=>t(!0),children:e.jsx(z,{})}),j&&e.jsxs(a,{show:j,onHide:r,centered:!0,children:[e.jsx(a.Header,{closeButton:!0,children:e.jsxs(a.Title,{children:["Supprimer Préjudice",u==="loading"&&e.jsx(D,{animation:"border",className:"ms-3",size:"sm"})]})}),e.jsxs(d,{onSubmit:p(x),children:[e.jsxs(a.Body,{className:"p-4",children:[e.jsx("p",{className:"mb-3",children:"Confirmez-vous la suppression du préjudice suivant ?"}),e.jsx("p",{className:"fw-bold text-primary",children:c}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"Raison"}),e.jsxs(d.Select,{...o("reason",{required:"Ce champ est requis"}),className:`shadow-sm ${h.reason?"is-invalid":""}`,children:[e.jsx("option",{value:"",children:"-- Choisir --"}),e.jsx("option",{value:"Bad data",children:"Données erronées"}),e.jsx("option",{value:"Data created by mistake and more",children:"Données créées par erreur"})]}),h.reason&&e.jsx("div",{className:"invalid-feedback",children:h.reason.message})]})]}),e.jsxs(a.Footer,{className:"border-0 justify-content-between",children:[e.jsx(l,{variant:"outline-secondary",onClick:r,type:"button",className:"shadow-sm",children:"Annuler"}),e.jsx(l,{variant:"danger",type:"submit",className:"shadow-sm px-4",children:"Supprimer"})]})]})]})]})};function Y(){const[n,c]=U.useState(!1),o=C(),{complaintTypes:y}=w(s=>s.complaintType),{prejudices:p}=w(s=>s.prejudice),{register:m,reset:h,handleSubmit:j,formState:{errors:t}}=F();k.useEffect(()=>{o(_()),o($())},[o]);const i=()=>{const s=p.map(({referenceNumber:L,name:T,typeName:B})=>({"Numéro de référence":L,Nom:T,"Type de plainte":B})),b=S.json_to_sheet(s),v=S.book_new();S.book_append_sheet(v,b,"Préjudices");const A=O(v,{bookType:"xlsx",type:"array"}),P=new Blob([A],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),E=URL.createObjectURL(P),f=document.createElement("a");f.href=E,f.setAttribute("download","prejudices.xlsx"),document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(E)},u=async s=>{const b=g.loading("Veuillez patienter...");try{await o(M(s)).unwrap(),g.update(b,{render:"Préjudice ajouté avec succès",type:"success",isLoading:!1,autoClose:2e3})}catch(v){g.update(b,{render:String(v),type:"error",isLoading:!1,autoClose:4e3})}x()},x=()=>{c(!1),h()},r=()=>c(!0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-4",children:[e.jsx("h3",{className:"fw-bold",children:"Liste de Préjudices"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(l,{variant:"success",onClick:i,className:"shadow-sm",children:"Exporter en Excel"}),e.jsx(l,{variant:"primary",onClick:r,className:"shadow-sm",children:"Ajouter un préjudice"})]})]}),e.jsx(V,{children:e.jsxs(G,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"shadow-sm",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nom"}),e.jsx("th",{children:"Type de plainte"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:p.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:s.typeName}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(K,{prejudice:s}),e.jsx(Q,{id:s.id,name:s.name})]})})]},s.id))})]})})]}),n&&e.jsxs(a,{show:n,onHide:x,centered:!0,children:[e.jsx(a.Header,{closeButton:!0,children:e.jsx(a.Title,{children:"Ajouter un Préjudice"})}),e.jsx(a.Body,{children:e.jsxs("form",{onSubmit:j(u),children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Nom"}),e.jsx("input",{id:"name",className:`form-control shadow-sm ${t.name?"is-invalid":""}`,...m("name",{required:"Ce champ est requis"})}),t.name&&e.jsx("div",{className:"invalid-feedback",children:t.name.message})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"type",className:"form-label",children:"Type de plainte"}),e.jsxs("select",{id:"type",className:`form-control shadow-sm ${t.type?"is-invalid":""}`,...m("type",{required:"Veuillez sélectionner un type de plainte"}),children:[e.jsx("option",{value:"",children:"-- Choisir un type de plainte --"}),y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),t.type&&e.jsx("div",{className:"invalid-feedback",children:t.type.message})]}),e.jsx(l,{variant:"primary",type:"submit",className:"w-100 shadow-sm",children:"Enregistrer"})]})})]})]})}export{Y as default};
